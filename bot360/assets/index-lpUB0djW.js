(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const f of s)if(f.type==="childList")for(const v of f.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&r(v)}).observe(document,{childList:!0,subtree:!0});function e(s){const f={};return s.integrity&&(f.integrity=s.integrity),s.referrerPolicy&&(f.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?f.credentials="include":s.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function r(s){if(s.ep)return;s.ep=!0;const f=e(s);fetch(s.href,f)}})();function ur(){var m=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],a=this;this.testVar="ohboy",this.variationsOn=function(r,s){var f=r;if(!a.isHex(r))console.warn("this version of the code doesn't support web color names anymore.  Please hexify it for now; sorry!");else{var v=a.hexToRgb(f),b=Math.random(),S=Math.random(),u=Math.random(),t=Math.max(0,Math.min(255,Math.round(v.r+b*s-s/2))),E=Math.max(0,Math.min(255,Math.round(v.g+S*s-s/2))),A=Math.max(0,Math.min(255,Math.round(v.b+u*s-s/2)));f=a.rgbToHex({r:t,g:E,b:A})}return f},this.valueOfHexCol=function(r){var s=a.hexToRgb(r);return(s.r+s.g+s.b)/3},this.palette8bit=[0,8388608,32768,8421376,128,8388736,32896,12632256,8421504,16711680,65280,16776960,255,16711935,65535,16777215,0,95,135,175,215,255,24320,24415,24455,24495,24535,24575,34560,34655,34695,34735,34775,34815,44800,44895,44935,44975,45015,45055,55040,55135,55175,55215,55255,55295,65280,65375,65415,65455,65495,65535,6225920,6226015,6226055,6226095,6226135,6226175,6250240,6250335,6250375,6250415,6250455,6250495,6260480,6260575,6260615,6260655,6260695,6260735,6270720,6270815,6270855,6270895,6270935,6270975,6280960,6281055,6281095,6281135,6281175,6281215,6291200,6291295,6291335,6291375,6291415,6291455,8847360,8847455,8847495,8847535,8847575,8847615,8871680,8871775,8871815,8871855,8871895,8871935,8881920,8882015,8882055,8882095,8882135,8882175,8892160,8892255,8892295,8892335,8892375,8892415,8902400,8902495,8902535,8902575,8902615,8902655,8912640,8912735,8912775,8912815,8912855,8912895,11468800,11468895,11468935,11468975,11469015,11469055,11493120,11493215,11493255,11493295,11493335,11493375,11503360,11503455,11503495,11503535,11503575,11503615,11513600,11513695,11513735,11513775,11513815,11513855,11523840,11523935,11523975,11524015,11524055,11524095,11534080,11534175,11534215,11534255,11534295,11534335,14090240,14090335,14090375,14090415,14090455,14090495,14114560,14114655,14114695,14114735,14114775,14114815,14124800,14124895,14124935,14124975,14125015,14125055,14135040,14135135,14135175,14135215,14135255,14135295,14145280,14145375,14145415,14145455,14145495,14145535,14155520,14155615,14155655,14155695,14155735,14155775,16711680,16711775,16711815,16711855,16711895,16711935,16736e3,16736095,16736135,16736175,16736215,16736255,16746240,16746335,16746375,16746415,16746455,16746495,16756480,16756575,16756615,16756655,16756695,16756735,16766720,16766815,16766855,16766895,16766935,16766975,16776960,16777055,16777095,16777135,16777175,16777215,526344,1184274,1842204,2500134,3158064,3815994,4473924,5131854,5789784,6447714,7105644,7763574,8421504,9079434,9737364,10395294,11053224,11711154,12369084,13027014,13684944,14342874,15000804,15658734],this.randomPastel=function(){var r=Math.floor(190+Math.random()*65),s=Math.floor(190+Math.random()*65),f=Math.floor(190+Math.random()*65),v={r,g:s,b:f};return a.rgbToHex(v)},this.randomBlue=function(){var r=Math.floor(0+Math.random()*150),s=Math.floor(0+Math.random()*150),f=Math.floor(0+Math.random()*255),v={r,g:s,b:f};return a.rgbToHex(v)},this.almostBW=function(){return Math.random()<.1?a.randomHex(!0):Math.random()<.5?a.randomPastel():a.randomDarkGrey()},this.almostBlue=function(){return Math.random()<.1?a.randomHex(!0):a.randomBlue()},this.randomHex=function(r){var s=Math.floor(Math.random()*255),f=Math.floor(Math.random()*255),v=Math.floor(Math.random()*255),b={r:s,g:f,b:v};return a.rgbToHex(b)},this.greyHex=function(r){return a.rgbToHex({r,g:r,b:r})},this.randomBright=function(){for(var r="#",s=Math.floor(Math.random()*3),f=0;f<6;f++)(f==0||f==1)&&s==0||(f==2||f==3)&&s==1||(f==4||f==5)&&s==2?r=r+"0":r=r+m[Math.floor(Math.random()*8)+8];return r},this.randomBlack=function(){var r=Math.max(0,Math.min(255,Math.floor(Math.random()*15))),s=Math.max(0,Math.min(255,Math.floor(Math.random()*15))),f=Math.max(0,Math.min(255,Math.floor(Math.random()*15)));return a.rgbToHex({r,g:s,b:f})},this.randomDarker=function(){var r=Math.floor(Math.random()*15),s=Math.floor(Math.random()*15),f=Math.floor(Math.random()*15);return a.rgbToHex({r,g:s,b:f})},this.rgbToHex=function(r){return"#"+e(r.r)+e(r.g)+e(r.b)},this.randomDarkGrey=function(){var r=15,s=r+Math.floor(Math.random()*r*4),f=Math.max(0,Math.min(255,Math.floor(s+Math.floor(Math.random()*r*2)-r))),v=Math.max(0,Math.min(255,Math.floor(s+Math.floor(Math.random()*r*2)-r))),b=Math.max(0,Math.min(255,Math.floor(s+Math.floor(Math.random()*r*2)-r)));return a.rgbToHex({r:f,g:v,b})},this.randomGrey=function(){var r=80,s=Math.floor(Math.random()*r*2),f=Math.max(0,Math.min(255,Math.floor(s+Math.floor(Math.random()*r)-r/2))),v=Math.max(0,Math.min(255,Math.floor(s+Math.floor(Math.random()*r)-r/2))),b=Math.max(0,Math.min(255,Math.floor(s+Math.floor(Math.random()*r)-r/2)));return a.rgbToHex({r:f,g:v,b})},this.randomDark=function(){var r=Math.floor(Math.random()*80),s=Math.floor(Math.random()*80),f=Math.floor(Math.random()*80);return a.rgbToHex({r,g:s,b:f})},this.brightenByAmt=function(r,s){var f;if(a.isHex(r))f=a.hexToRgb(r);else if(r.r!==void 0&&r.g!==void 0&&r.b!==void 0)f=r;else{console.warn("what kind of a color is "+r+" ?  Can't brighten.");return}return f.r=Math.max(0,Math.min(255,Math.floor(f.r+s))),f.g=Math.max(0,Math.min(255,Math.floor(f.g+s))),f.b=Math.max(0,Math.min(255,Math.floor(f.b+s))),a.isHex(r)?a.rgbToHex(f):(console.log("brightenByAmt returning in rgb format"),f)},this.intToHex=function(r){return"#"+r.toString(16)},this.parseHex=function(r){return typeof r=="number"?r:parseInt(r.replace(/#/g,"0x"))},a.greyFromCol=function(r){let s=a.hexToRgb(r),f=(s.r+s.g+s.b)/3;return s.r=s.g=s.b=Math.round(f),a.rgbToHex(s)},a.hexToInt=function(r){for(var s=0,f=1;f<r.length;f++)for(var v=r.charAt(f),b=0;b<m.length;b++)v==m[b]&&(s+=b*Math.pow(16,5-(f-1)));return s},this.hexToBgrInt=function(r){return a.hexToInt(a.rgbToBgrHex(a.hexToRgb(r)))},this.isHex=function(r){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(r)},this.webColourToHex=function(r){var s=document.createElement("div");s.style.color=r;var f=window.getComputedStyle(document.body.appendChild(s)).color.match(/\d+/g).map(function(b){return parseInt(b,10)});document.body.removeChild(s);var v=f.length>=3?"#"+((1<<24)+(f[0]<<16)+(f[1]<<8)+f[2]).toString(16).substr(1):!1;if(v)return v;throw r+" does not represent a known web colour."},this.nameToHex=function(r){if(a.isHex(r))return r;console.warn("what type of entity is this? "+r)},this.complimentaryRGB=function(r){return{r:255-r.r,g:255-r.g,b:255-r.b}},this.complimentaryHex=function(r){return a.rgbToHex(a.complimentaryRGB(a.hexToRgb(r)))},this.mixHexCols=function(r,s,f,v){var b=a.hexToRgb(r),S=a.hexToRgb(s),u={r:Math.floor(b.r*f+S.r*v),g:Math.floor(b.g*f+S.g*v),b:Math.floor(b.b*f+S.b*v)};return a.rgbToHex(u)},this.addHexCols=function(r,s,f,v){var b=a.hexToRgb(r),S=a.hexToRgb(s),u={r:Math.floor(Math.min(255,b.r+S.r)),g:Math.floor(Math.min(255,b.g+S.g)),b:Math.floor(Math.min(255,b.b+S.b))};return a.rgbToHex(u)},this.hexToRgb=function(r){var s=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;r=r.replace(s,function(b,S,u,t){return S+S+u+u+t+t});var f=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r),v=f?{r:parseInt(f[1],16),g:parseInt(f[2],16),b:parseInt(f[3],16)}:null;return v==null&&console.warn("tried to rgbify hex "+r+" but it broke."),v},this.rgbToHex=function(r){return"#"+e(r.r)+e(r.g)+e(r.b)},this.rgbToBgrHex=function(r){return"#"+e(r.b)+e(r.g)+e(r.r)};function e(r){var s=r.toString(16);return s.length==1?"0"+s:s}}function xr(){var m=this;this.randomInt=function(a,e){return Math.floor(m.random(a,e))},this.random=function(a,e){var r,s;return e==null?(r=0,s=a):(r=a,s=e),r+Math.random()*(s-r)},this.randomFrom=function(a){return a[Math.floor(Math.random()*a.length)]},this.randomSign=function(a){return a*(Math.random()>.5?1:-1)},this.shuffle=function(a){var e=0,r=0,s=null;for(e=a.length-1;e>0;e-=1)r=Math.floor(Math.random()*(e+1)),s=a[e],a[e]=a[r],a[r]=s;return a}}function Ar(m){var a=this,e=new ur;new xr;var r=m.RAINBOW;a.circleMesh=function(s,f){var v=new THREE.CircleGeometry(f,8),b=new THREE.MeshBasicMaterial({color:r?e.parseHex(e.randomHex()):e.parseHex(s)});return new THREE.Mesh(v,b)},a.sphereMesh=function(s,f){var v=new THREE.SphereGeometry(f,3,4),b=new THREE.MeshBasicMaterial({color:e.parseHex(s)});return new THREE.Mesh(v,b)},a.diamondMesh=function(s,f,v){var b=new THREE.Geometry,S=new THREE.Vector3(0,0,0),u=new THREE.Vector3(-f/2,v/4,0),t=new THREE.Vector3(0,v,0),E=new THREE.Vector3(f/2,v/4,0);b.vertices.push(S),b.vertices.push(u),b.vertices.push(t),b.vertices.push(E),b.faces.push(new THREE.Face3(0,1,2));var A,O=new THREE.MeshBasicMaterial({color:A});return new THREE.Mesh(b,O)}}function Xr(m){var a=this,e=new ur,r=new xr;this.options=G(m);var s=new Ar(a.options),f=a.options.RAINBOW,v=0;function b(){var o=Math.random();return o<.2?r.random(0,.02):o<.8?r.random(.02,.03):r.random(.03,.05)}function S(){return r.random(1,3)}function u(o,n){var d=o||[],l=n||0;if(l<a.options.MAX_DEPTH){for(var M=a.options.BRANCH_P-Math.min(a.options.BRANCH_P*.8,a.options.CHANCE_DECAY*l);v==0||d.length<a.options.MAX_BRANCHES_PER_NODE&&v<a.options.MAX_BRANCHES_TOTAL&&Math.random()<M;){var c=u([],l+1);d.push(c),v++}if(d==[])for(var p=r.randomInt(2,3),h=0;h<p.length;h++)d.push([])}return d}function t(o){var n=0,d=[];for(let l=0;l<o.length;l++)d.push(t(o[l]));for(let l=0;l<d.length;l++)d[l]>n&&(n=d[l]);return n+1}function E(o,n,d){var l=s.sphereMesh(o,n);return l.scale.x=d,l}function A(o){return o*(Math.PI/180)}function O(o,n,d,l,M,c){var p=o*r.random(1,1.4),h=Math.min(p,a.options.BRANCH_L);n==1&&(h=h/2);var x=function(vr,pr){var cr=M+vr/l*(c-M);return cr},I=x(n),N=x(Math.max(0,n-1)),q=new THREE.CylinderGeometry(N,I,h,8),D=new THREE.SphereGeometry(N,2,2),k,W=(l-d)/l,B=1-W,Y=e.mixHexCols(a.options.COLOR_BTM,a.options.COLOR_TOP,W,B);k=f?e.parseHex(e.randomHex()):e.parseHex(Y);var rr=new THREE.MeshBasicMaterial({color:k}),J=new THREE.Mesh(q,rr);J.position.y=h/2;var $=new THREE.Mesh(D,rr),ar=new THREE.Object3D;ar.position.y=h,ar.add($);var V=new THREE.Object3D;return V.add(J),V.add(ar),V.tip=ar,V.length=h,V.tip.leaves=[],n<=2&&w(V.tip,r.randomInt(a.options.LEAF_DENSITY,a.options.LEAF_DENSITY),a.options.LEAF_COLS,a.options.LEAF_SIZE*2,0,0,a.options.LEAF_W),V}function w(o,n,d,l,M,c,p){for(let N=0;N<n;N++){var h=r.randomFrom(d),x=E(h,l,p),I=1.2;x.position.y+=r.random(-.5,2)*I+M,x.position.x+=r.randomSign(r.random(.75)*I+c),x.position.z+=r.randomSign(r.random(.75)*I+c),x.rotation.x=r.random(-Math.PI/2,Math.PI),x.rotation.y=r.random(-Math.PI/2,Math.PI),x.rotation.z=r.random(-Math.PI/2,Math.PI),o.rotation.y+=Math.PI*2/n,o.add(x),o.leaves.push([x,h,l,p])}}function P(o,n,d,l,M,c){var p=A(a.options.ANGLE_MIN+r.random(a.options.ANGLE_MAX-a.options.ANGLE_MIN));l<2&&(p=p/4);var h=O(n,d,l,M,a.options.BRANCH_R_MIN,c);h.branches=[];for(var x=0;x<o.length;x++){var I=P(o[x],n*a.options.LENGTH_MULT,t(o[x]),l+1,M,c),N=1.2-l/M;I.rotation.x=h.rotation.x+r.random(-p,p)*N,I.rotation.z=h.rotation.z+r.random(-p,p)*N,h.tip.add(I),h.branches.push([I,I.rotation.x,I.rotation.z])}return h}function L(o,n,d,l,M,c){for(var p=P(o,n,d,l,M,c),h=r.randomInt(3,10),x=r.random(Math.PI*2),I=e.parseHex(a.options.COLOR_BTM),N=0;N<h;N++){var q=r.random(c*.3,c*.7),D=r.random(n*.05,n*.25),k=new THREE.CylinderGeometry(q,.01,D,8),W=new THREE.MeshBasicMaterial({color:I}),B=new THREE.Mesh(k,W),Y=new THREE.Object3D;B.rotation.x=-Math.PI/2.4,B.position.z=D/2,Y.add(B),Y.rotation.y=x+N*(Math.PI*2/h),p.add(Y)}return p}this.getTree=function(o){v=0,j(o);for(var n=[];n.length==0;)n=u();return L(n,o.BRANCH_L,t(n),0,t(n),o.BRANCH_R_MAX)};function j(o){o!=null&&(a.options=o)}this.getNewParameters=function(){let o=G();return a.options=o,o};function G(o){let n=r.random(1.5,3),d=o==null?Math.random()<.7:o.NIGHT_MODE;var l=e.randomHex(),M=e.randomDark(),c=e.randomHex(),p=[];for(let I=0;I<8;I++)p.push(e.variationsOn(c,30));var h={RAINBOW:!1,NIGHT_MODE:d,BRANCH_R_MAX:n,BRANCH_R_MIN:.05,BRANCH_L:Math.max(r.random(6,10)),BRANCH_P:r.random(.72,.75),CHANCE_DECAY:b(),LENGTH_MULT:r.random(.85,.9),ANGLE_MIN:r.random(15,45),ANGLE_MAX:r.random(45,75),COLOR_TOP:l,COLOR_BTM:M,LEAF_COLS:p,LEAF_SIZE:S(),LEAF_DENSITY:3+r.randomInt(2),LEAF_W:r.random(.9,1.2),MAX_DEPTH:12,MAX_BRANCHES_TOTAL:400,MAX_BRANCHES_PER_NODE:r.randomInt(3,4)};if(h!==void 0)for(var x in o)h[x]!==void 0&&(h[x]=o[x]);return h}}function kr(m){var a=this,e=new ur,r=new xr;this.options=G(m);var s=new Ar(a.options),f=a.options.RAINBOW,v=0;function b(){return .012}function S(){return r.random(1.25,2.5)}function u(o,n){var d=o||[],l=n||0;if(l<a.options.MAX_DEPTH){for(var M=a.options.BRANCH_P-Math.min(a.options.BRANCH_P*.8,a.options.CHANCE_DECAY*l);v==0||d.length<a.options.MAX_BRANCHES_PER_NODE&&v<a.options.MAX_BRANCHES_TOTAL&&Math.random()<M;){var c=u([],l+1);d.push(c),v++}if(d==[])for(var p=r.randomInt(2,3),h=0;h<p.length;h++)d.push([])}return d}function t(o){var n=0,d=[];for(let l=0;l<o.length;l++)d.push(t(o[l]));for(let l=0;l<d.length;l++)d[l]>n&&(n=d[l]);return n+1}function E(o,n,d){var l=s.sphereMesh(o,n);return l.scale.x=d,l}function A(o){return o*(Math.PI/180)}function O(o,n,d,l,M,c){var p;d<2?p=o/(4-2*d):d==2?p=o*2:p=o*r.random(1,1.4);var h=Math.min(p,a.options.BRANCH_L);n==1&&(h=h/2);var x=function(vr,pr){let cr=M+vr/l*(c-M);return pr<2&&(cr*=2-.5*pr),cr},I=x(n,d),N=x(Math.max(0,n-1),d+1),q=new THREE.CylinderGeometry(N,I,h,5),D=new THREE.SphereGeometry(N,2,2),k,W=(l-d)/l,B=1-W,Y=e.mixHexCols(a.options.COLOR_BTM,a.options.COLOR_TOP,W,B);k=f?e.parseHex(e.randomHex()):e.parseHex(Y);var rr=new THREE.MeshBasicMaterial({color:k}),J=new THREE.Mesh(q,rr);J.position.y=h/2;var $=new THREE.Mesh(D,rr),ar=new THREE.Object3D;ar.position.y=h,d>0&&ar.add($);var V=new THREE.Object3D;return V.add(J),V.add(ar),V.tip=ar,V.length=h,V.tip.leaves=[],n<=2&&(w(V.tip,1,a.options.LEAF_COLS,a.options.LEAF_SIZE,0,0,a.options.LEAF_W),w(V.tip,a.options.LEAF_DENSITY,a.options.LEAF_COLS,a.options.LEAF_SIZE,a.options.LEAF_SIZE*2,a.options.LEAF_SIZE*2,a.options.LEAF_W)),V}function w(o,n,d,l,M,c,p){for(let N=0;N<n;N++){var h=r.randomFrom(d),x=E(h,l,p),I=1.2;x.position.y+=r.random(-.5,2)*I+M,x.position.x+=r.randomSign(r.random(.75)*I+c),x.position.z+=r.randomSign(r.random(.75)*I+c),x.rotation.x=r.random(-Math.PI/2,Math.PI),x.rotation.y=r.random(-Math.PI/2,Math.PI),x.rotation.z=r.random(-Math.PI/2,Math.PI),o.rotation.y+=Math.PI*2/n,o.add(x),o.leaves.push([x,h,l,p])}}function P(o,n,d,l,M,c){A(a.options.ANGLE_MIN+r.random(a.options.ANGLE_MAX-a.options.ANGLE_MIN));var p=O(n,d,l,M,a.options.BRANCH_R_MIN,c);p.branches=[],r.random(Math.PI*2);for(var h=0;h<o.length;h++){var x=P(o[h],n*a.options.LENGTH_MULT,t(o[h]),l+1,M,c),I=5;const N=A(l<2?-a.options.ANGLE_MIN/12:a.options.ANGLE_MIN/2),q=A(l<2?-a.options.ANGLE_MAX/12:a.options.ANGLE_MAX/2),D=1,k=r.randomInt(2,5);x.rotation.y=r.random(Math.PI/32),x.rotation.x=r.random(-1,1)*r.random(N/k,q/k)*D*I,p.tip.add(x),p.branches.push([x,x.rotation.x,x.rotation.z])}return p}function L(o,n,d,l,M,c){var p=P(o,n,d,l,M,c),h=r.randomInt(3,7);r.random(Math.PI*2);for(var x=e.parseHex(a.options.COLOR_BTM),I=0;I<h;I++){var N=r.random(c*2/(h*2),c*3/h),q=r.random(n*.5,n*.75),D=new THREE.CylinderGeometry(N,.01,q,8),k=new THREE.MeshBasicMaterial({color:x}),W=new THREE.Mesh(D,k),B=new THREE.Object3D;W.position.z=q/2+N,W.position.y=0,W.rotation.x=-Math.PI/2.5,B.add(W),B.rotation.y=I*(Math.PI*2/h),p.add(B)}return p.rotation.y=r.random(Math.PI*2),p}this.getTree=function(o){v=0,j(o);for(var n=[];n.length==0;)n=u();return L(n,o.BRANCH_L,t(n),0,t(n),o.BRANCH_R_MAX)};function j(o){o!=null&&(a.options=o)}this.getNewParameters=function(o=!1){let n=G({},o);return a.options=n,n};function G(o,n=!1){let d=r.random(2,3),l=o==null?Math.random()<.7:o.NIGHT_MODE;var M=e.randomHex(),c=e.randomDark(),p=e.randomHex(),h=[];for(let N=0;N<8;N++)h.push(e.variationsOn(p,30));var x={RAINBOW:!1,NIGHT_MODE:l,BRANCH_R_MAX:d,BRANCH_R_MIN:.05,BRANCH_L:r.random(7,11),BRANCH_P:n?r.random(.7,.75):r.random(.73,.78),CHANCE_DECAY:b(),LENGTH_MULT:r.random(.88,.92),ANGLE_MIN:r.random(15,30),ANGLE_MAX:r.random(40,60),COLOR_TOP:M,COLOR_BTM:c,LEAF_COLS:h,LEAF_SIZE:S(),LEAF_DENSITY:n?2:3+r.randomInt(3),LEAF_W:r.random(.9,1.2),MAX_DEPTH:n?10:11,MAX_BRANCHES_TOTAL:n?100:300,MAX_BRANCHES_PER_NODE:2};if(x!==void 0)for(var I in o)x[I]!==void 0&&(x[I]=o[I]);return x}}function Ur(m){var a=new ur,e=new xr;this.options=G(m);var r=this.options,s=new Ar(r),f=r.RAINBOW;function v(){var o=Math.random();return o<.2?e.random(.1,.3):o<.5?e.random(.4,.9):o<.95?e.random(1,1.4):e.random(1.5,2.8)}function b(){var o=Math.random();return o<.3?e.random(.01,.03):o<.9?e.random(.03,.06):e.random(.06,.07)}function S(){var o=Math.random();return o<.33?e.random(.15,.4):o<.7?e.random(.4,.8):o<.9?e.random(.8,1):e.random(1,1.4)}function u(o,n,d){for(var l=0;l<d;l++){for(var M=[],c=0;c<r.MAX_BRANCHES_PER_NODE;c++)Math.random()<r.BRANCH_P&&M.push([]);o.push(M)}return o}function t(o){var n,d=0,l=[];for(n=0;n<o.length;n++)l.push(t(o[n]));for(n=0;n<l.length;n++)l[n]>d&&(d=l[n]);return d+1}function E(o,n,d){var l=s.diamondMesh(o,n);return l.scale.x=d,l}function A(o){return o*(Math.PI/180)}function O(o,n,d,l,M,c,p){var h=o*e.random(1,1.4);Math.min(h,r.BRANCH_L);var x=function(ar,V){var vr=M+ar/l*(c-M);return vr};d<=1&&(h*=2);var I=x(n),N=x(Math.max(0,n-1)),q=new THREE.CylinderGeometry(N,I,h,8),D=new THREE.SphereGeometry(N,2,2),k=(l-d)/l,W=1-k;f?a.randomHex():a.mixHexCols(r.COLOR_BTM,r.COLOR_TOP,k,W),console.log("rootColInt: "+rootColInt);var B=new THREE.MeshBasicMaterial({color:a.parseHex(rootColInt)}),Y=new THREE.Mesh(q,B);Y.position.y=h/2;var rr=new THREE.Mesh(D,B),J=new THREE.Object3D;J.position.y=h,J.add(rr);var $=new THREE.Object3D;return $.add(Y),$.add(J),$.tip=J,$.length=h,n==1&&w($.tip,r.LEAF_DENSITY,r.LEAF_COLS,r.LEAF_SIZE,0,0,r.LEAF_W),$}function w(o,n,d,l,M,c,p){var h=e.random(Math.PI*2);for(i=0;i<n;i++){var x=new THREE.Object3D,I=e.randomFrom(d),N=E(I,l,p);N.position.y=l/2,N.rotation.x=e.random(-r.ANGLE_MAX,-r.ANGLE_MIN),x.add(N),x.rotation.y=h+i*Math.PI*2/n,x.position.y-=e.random(0,r.BRANCH_L/2),o.add(x)}}function P(o,n,d,l,M,c,p){var h=e.random(Math.PI*2);t(o)==M;var x=Math.min(r.BRANCH_R_MIN,c*.5),I=O(.1,M,l,M,x,c,COLOR_BTM),N=I;d==1?I.tip.rotation.x=A(125):d>1&&(I.tip.rotation.x=A(65));var q=A(p?180+r.ANGLE_MIN/2:r.ANGLE_MIN/2),D=A(p?180+r.ANGLE_MAX/2:r.ANGLE_MAX/2),k=n*r.LENGTH_MULT;console.log("     d     "+d+",     ftd "+M);for(var W=d<=1?M:Math.min(4,M),B=0;B<W;B++){console.log("-------------trunkpiece "+B);var Y=O(n,o.length-B,B,W,x*((o.length-B)/o.length),c*((o.length-B)/o.length),COLOR_BTM);if(Y.rotation.x=d==0?e.random(-.1,.1):d>1&&B>1?-e.random(-q/10,-D/10):e.random(-q/10,-D/10),N.tip.add(Y),h=e.random(Math.PI*2),B>0&&d<2){for(var rr=0;rr<o[B].length;rr++)if(!(Math.random()>1/Math.log(d+3))){console.log("---------=== branch "+rr),k=n*((o.length-B)/o.length)/3;var J=P(o,k,d+1,B,M-1,c*((o.length-B)/o.length)/3,!1),$=new THREE.Object3D;$.rotation.y=h+rr*Math.PI*2/o[B].length,J.position.y=e.random(-n/3,n/3),$.add(J),N.tip.add($)}}N=Y}return I}function L(o,n,d,l,M,c){for(var p=P(o,n,0,l,M,c,!0),h=e.randomInt(3,10),x=e.random(Math.PI*2),I=f?a.parseHex(a.randomHex()):a.parseHex(r.COLOR_BTM),N=0;N<h;N++){var q=e.random(c*.3,c*.7),D=e.random(n*.02,n*.1),k=new THREE.CylinderGeometry(q,.01,D,8),W=new THREE.MeshBasicMaterial({color:a.parseHex(I)}),B=new THREE.Mesh(k,W),Y=new THREE.Object3D;B.rotation.x=-Math.PI/2.4,B.position.z=D/2+c/2*.9,Y.add(B),Y.rotation.y=x+N*(Math.PI*2/h),p.add(Y)}return p}this.getTree=function(o){j(o);var n=[];return n=u([],0,r.MAX_DEPTH),L(n,r.BRANCH_L,n.length,0,n.length,r.BRANCH_R_MAX)};function j(o){_o=this.options=o}function G(o){var n=5*v(),d=a.randomHex(),l=o.NIGHT_MODE?a.brightenByAmt(a.randomHex(),-60):a.variationsOn(a.randomHex(),80),M=[];for(let h=0;h<8;h++)M.push(a.variationsOn(l,30));var c={RAINBOW:!1,NIGHT_MODE:!1,BRANCH_R_MAX:n,BRANCH_R_MIN:n*e.random(.03),TRUNK_R_MAX:e.random(5,25),TRUNK_R_MIN:e.random(2),BRANCH_L:e.random(3,7),BRANCH_P:e.random(.85,.95),CHANCE_DECAY:b(),LENGTH_MULT:e.random(.85,.95),ANGLE_MIN:e.random(100,110),ANGLE_MAX:e.random(120,135),COLOR_BTM:d,COLOR_TOP:a.variationsOn(d,180),LEAF_COLS:M,LEAF_SIZE:S(),LEAF_DENSITY:e.randomInt(24),LEAF_W:e.random(.1,.2),MAX_DEPTH:e.random(8,20),MAX_BRANCHES_TOTAL:9999,MAX_BRANCHES_PER_NODE:e.randomInt(3,6),LEAF_DENSITY:e.randomInt(24)};for(var p in o)c[p]!==void 0&&(c[p]=o[p]);return console.log("decay "+c.CHANCE_DECAY+`
max depth `+c.MAX_DEPTH+`
branches per node `+c.MAX_BRANCHES_PER_NODE),c}}function Wr(m){var a=new ur,e=new xr;this.options=E(m);var r=this.options;function s(A,O,w){var P=f(A,O);return P.scale.x=w,P}function f(A,O){var w=new THREE.CircleGeometry(O,8),P=new THREE.MeshBasicMaterial({color:a.parseHex(A)});return new THREE.Mesh(w,P)}function v(A,O,w,P){var L=new THREE.CylinderGeometry(O,w,P,8),j=a.parseHex(A);for(i=0;i<L.faces.length;i++)L.faces[i].color.setHex(j);var G=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,overdraw:.5});return new THREE.Mesh(L,G)}function b(A){return A*(Math.PI/180)}function S(A,O,w){var P=v(r.STEM_COL,.01,.02,O),L=.3,j=.2;console.log("frond with "+w+" leaves of length "+L);for(var G=0;G<w;G++){var o=L*((w-G)/w),n=s(A,o,j),d=s(A,o,j);n.rotation.z=-Math.PI/2,n.position.x=-L/2,n.position.y=G*(O/w),d.rotation.z=Math.PI/2,d.position.x=L/2,d.position.y=G*(O/w),P.add(n),P.add(d)}return P}function u(){var A=new THREE.Object3D;A.tip=A;var O=e.randomInt(r.MAX_DEPTH/2,r.MAX_DEPTH);e.randomInt(0,5);for(var w=[A],P=.1,L=1,j=e.random(2,5),G=e.randomFrom(r.LEAF_COLS),o=e.random(r.MIN_FLOP,r.MAX_FLOP),n=0;n<O;n++){var d=new THREE.Object3D,l=L-n*.03,M=v(r.STEM_COL,P-(n+1)*.005,P-n*.005,l);M.y=l/2;var c=new THREE.Object3D;c.position.y=l,M.add(c),d.add(M),d.tip=c,d.rotation.x=o;var p=w[w.length-1];if(p.tip.add(d),n>j){var h=O*L*((O-n)/O),x=S(G,h,O-n),I=S(G,h,O-n);x.rotation.z=-Math.PI/2+o/2,I.rotation.z=Math.PI/2+o/2,d.add(x),d.add(I)}w.push(d)}return A}function t(){for(var A=new THREE.Object3D,O=e.random(2,5),w=0;w<O;w++){var P=u();P.rotation.y=w*(Math.PI*2)/O,A.add(P)}return A}this.getFern=function(A){return t()};function E(A){var O=A||a.randomHex(),w=a.variationsOn(O,10),P=[];for(let j=0;j<8;j++)P.push(a.variationsOn(w,20));var L={STEM_COL:O,MAX_WIDTH:e.randomInt(8,20),MAX_DEPTH:20,MIN_FLOP:b(3),MAX_FLOP:b(15),LEAF_COLS:P};return L}}function Yr(m,a,e,r,s,f){var v=e,b=s,S=f,u=new ur,t=new xr;new Wr;var E,A=m,O=a,w=A==null?!1:A.RAINBOW,P=t.random(.3,.8),L=A==null?Math.random()<.25:A.NIGHT_MODE,j=Math.random()<.25;O.NIGHT_MODE=L;var G=A==null?t.randomInt(50,200):A.NUM_TREES,o,n,d,l,M,c=-650,p=-690;I();var h=new Xr(O);new Ur(O);function x(){var _=Math.random();return _<.33?t.random(.15,.4):_<.7?t.random(.4,.8):_<.9?t.random(.8,1):t.random(1,1.4)}function I(){o=L?u.variationsOn("#4d6876",120):u.variationsOn("#bdeff1",150),n=L?u.variationsOn("#40523c",80):u.brightenByAmt(u.variationsOn("#78836e",150),t.randomInt(-25,-75)),d=[],l=[],M=[];var _=L?n:u.brightenByAmt(n,t.random(-30,10)),H=u.greyHex(L?t.randomInt(20,60):t.randomInt(90,130)),R=u.mixHexCols(H,n,.7,.3);R=u.mixHexCols(R,o,.8,.2),M[0]=R;for(let y=0;y<8;y++)d.push(u.variationsOn(n,15)),l.push(u.variationsOn(_,40))}function N(){var _=new THREE.Object3D,H=.5,R=new THREE.Vector3(0,0,-30);t.random(1,3);for(var y=t.random(1,5),C=0;C<400/H;C++){for(var z=t.random(10,20),g=t.random(1,3),F=.07,Z=.3,K=new THREE.Object3D,U=0;U<z;U++){var X=t.random(-g,g),er=F+Z*((g-Math.abs(X))/g),sr=Gr(M[0],er);sr.position.x=X,sr.position.z=t.random(-g,g),K.add(sr)}K.position.x=y*t.random(1,2)-y/2,K.position.z=R.z+C*H,_.add(K)}return _}function q(_,H,R){var y=D(_,H,4);return y.scale.x=R,y}function D(_,H,R,y=1){var C=new THREE.CircleGeometry(H,R),z=new THREE.MeshBasicMaterial({color:u.parseHex(_),opacity:y,transparent:y<1}),g=new THREE.Mesh(C,z);return g}function k(_,H){var R=new THREE.SphereGeometry(H,5,4,0,Math.PI*2,0,Math.PI/2),y=w?u.parseHex(u.randomHex()):u.parseHex(_),C=new THREE.MeshBasicMaterial({color:y});return new THREE.Mesh(R,C)}function W(_,H){return new THREE.SphereGeometry(_,16,8),new THREE.MeshBasicMaterial({color:H}),k(H,_)}function B(){var _=[],H=u.mixHexCols(u.randomHex(),h.options.COLOR_BTM,.3,.7);H=u.mixHexCols(H,n,.3,.7);for(let R=0;R<4;R++)_.push(u.variationsOn(H,20));return _}function Y(_,H,R,y){var C=new THREE.Object3D;for(let g=0;g<_*4;g++){var z=new THREE.Object3D;V(z,t.randomInt(5,12),R,y,0,0,y),z.position.x=t.random(-H,H),z.position.z=t.random(-H,H),z.position.y=g%2==0?_:t.random(_,_*.7+_-_*Math.abs(z.position.x)/H),C.add(z)}return C.position.y=-.5,C.scale.x=C.scale.y=C.scale.z=t.random(1,1.5),C}function rr(){E.bushes=[],t.random(.4,1);var _=t.randomInt(8,25),H=B(),R=t.random(h.options.LEAF_SIZE,h.options.LEAF_SIZE*2);t.random(.7,1);var y;let C=[];for(let X=0;X<8;X++)C.push(u.variationsOn(u.randomHex(),30));for(var z=[],y=0;y<H.length;y++)z.push(u.brightenByAmt(u.mixHexCols(H[y],o,.8,.2),-10));for(let X=0;X<30;X++){var g=Y(t.random(3,5),_,H,R*2);let er=t.randomFrom(A.TREES);g.position.x=er.position.x-t.random(-150,150),g.position.z=er.position.z-S+t.random(0,100),g.position.y=er.position.y-b+30,Math.random()<.4&&(g.position.x=g.position.x+t.random(-1e3,1e3),g.position.z=g.position.z+t.random(-200,200)),E.add(g),E.bushes.push([g,g.scale.y])}for(let X=0;X<50;X++){var g=Y(t.random(10,30),200,z,R*3.5);g.position.z=t.random(c,p),g.position.x=t.randomSign(t.random(0,v/2)),g.position.y=55-R*3,E.add(g),E.bushes.push([g,g.scale.y])}let F=u.parseHex(u.mixHexCols(n,o,.3,.7));for(let X=0;X<30;X++){let er=t.random(-v/2-100,v/2+100);for(let sr=0;sr<500;sr++){var Z=new THREE.CircleGeometry(10,4),K=new THREE.MeshBasicMaterial({color:F}),U=new THREE.Mesh(Z,K);U.position.z=-890;let nr=t.random(350,500),Cr=t.random(-nr,nr);U.position.x=er+Cr,U.position.y=t.random(50,200)-50*Math.abs(Cr)/nr,U.scale.x=U.scale.y=t.random(.5,3),E.add(U)}}}function J(){for(var _=[],H=u.randomBright(),R=0;R<4;R++)_.push(u.variationsOn(H,50));return _}function $(){var _=J(),H=t.randomInt(50,150),R=new THREE.Object3D,y=5,C=t.random(1.25,1.75);t.random(-50,-100);var z=t.random(-50,-200),g=t.random(-v/2,v/2),F=v/2,Z=C*t.random(.2,.3),K=t.randomFrom(_),U=K,X=Math.PI*t.random(1.25,1.5);let er=D(U,Z,4);for(var sr=0;sr<H;sr++){let nr=ar(y,er,Z,X);nr.position.z=900+sr*t.random(-z/3,z*(2/3)),nr.position.x=g+t.random(-F/2,F/2),nr.position.y=t.random(-80,0),nr.rotation.x+=t.random(-.3,.3),nr.rotation.z+=t.random(-.3,.3),nr.scale.x=nr.scale.y=nr.scale.z=t.random(15,25),R.add(nr)}return R}function ar(_,H,R,y){for(var C=new THREE.Object3D,z=0;z<_;z++){var g=new THREE.Object3D,F=H.clone();F.rotation.x=y,F.position.z=R/1.5,F.scale.x=2/_,g.add(F),g.position.y=1.1,g.rotation.y=z*(Math.PI*2/_),C.scale.x=C.scale.y=C.scale.z=1,C.add(g)}return C}function V(_,H,R,y,C,z,g){var F=t.randomFrom(R);for(let K=0;K<H;K++){var Z=q(F,y,g);Z.position.y+=t.random(0,2)+C,Z.position.x+=t.randomSign(t.random(.75)+z),Z.position.z+=t.randomSign(t.random(.75)+z),Z.rotation.x=t.random(-Math.PI/2,Math.PI),Z.rotation.y=t.random(-Math.PI/2,Math.PI),Z.rotation.z=t.random(-Math.PI/2,Math.PI),_.rotation.y+=Math.PI*2/H,_.add(Z)}}function vr(){for(var _=t.randomInt(14,24),H=400,R=.08,y=0;y<_;y++){var C=new THREE.Object3D,z=3+t.randomInt(12),g=t.randomInt(-v/2,v/2),F=t.random(160,700),Z=t.randomInt(15,30),K=u.brightenByAmt(o,Z);C.position.x=g,C.position.y=F;for(var U=0;U<z;U++){var X=D(K,t.random(H*.5,H),6,.5);X.scale.y=t.random(R),X.scale.x=t.random(.3,.7),X.position.z=-900+(5-5*(u.valueOfHexCol(K)/255));var er=H*R*1.5;X.position.y=t.random(-er/2,er/2),X.position.x=t.random(-H/4,H/4),C.add(X),C.brightness=Z}E.add(C),E.clouds.push(C)}}function pr(){t.randomInt(G*.5,G*1.5);var _=x();t.random(400,500);var H=t.random(150,250)/G;const R=new THREE.PlaneGeometry(8e3,1500,1,1),y=new THREE.MeshBasicMaterial({color:u.parseHex(o)}),C=new THREE.Mesh(R,y);C.position.z=-925,C.position.y=-50,E.skyCol=o,E.groundCol=n,E.sky=C,E.add(C),E.looseLeaves=[],E.clouds=[];var z=new THREE.SphereGeometry(30,4,4),g=new THREE.MeshBasicMaterial({color:u.parseHex(n)}),F=new THREE.Mesh(z,g);F.position.x=0,F.position.y=-100,F.position.z=-200,F.scale.x=1e3,F.scale.y=.005,F.scale.z=10,F.rotation.x=Math.PI/5,E.add(F);var Z=[];for(let U=0;U<G*2;U++)Z.push(U%G*H);Z=t.shuffle(Z);for(let U=0;U<G*12;U++){var K=new THREE.Object3D;K.position.x=t.randomSign(t.random(3,40)),K.position.z=U+t.random(-150,150),V(K,t.randomInt(0,15),l,_,0,0,P),E.add(K)}}function cr(){let _=[];for(let R=0;R<d.length;R++)_.push(u.variationsOn(u.brightenByAmt(d[R],50),25));let H=q(t.randomFrom(_),O.LEAF_SIZE*2.25,O.LEAF_W*2.5);for(let R=0;R<50;R++){let y=H.clone();y.position.x=t.random(-v/2-100,v/2+500),y.position.y=t.random(-100,170),y.position.z=t.random(300,900),E.looseLeaves.push([y,y.position.y,t.random(1e3),t.random(-1,1),t.random(1,3)]),E.add(y)}}function Sr(){var _=400;E.hills=[];var H=10;let R=[];for(var y=0;y<d.length;y++)R.push(W(H,d[y]));for(var y=0;y<_;y++){let g=R[y%R.length].clone();g.scale.x=t.random(50,150),g.scale.y=t.random(3,8),g.scale.z=t.random(30,80);var C=v*2;g.position.z=t.random(100,-500),g.position.x=t.random(-C/2-5,C/2+5),g.position.y=-120-g.position.z/3,E.hills.push(g),E.add(g)}}function Gr(_,H){var R=D(_,H,8);return R.rotation.x=-Math.PI/2,R}function zr(){var _=u.mixHexCols("#FFFFFF",o,.7,.3),H=D(_,2,4);return H}function Dr(){var _=300,H=new THREE.Object3D;E.stars=[];for(var R=zr(),y=0;y<_;y++){var C=R.clone();C.scale.x=C.scale.y=C.scale.z=t.random(1.5,3.5),H.add(C),C.position.x=t.random(-v/2,v/2),C.position.y=t.random(-300,600),C.position.z=-895,E.stars.push(C)}E.dome=H,E.add(H)}function Fr(){return E=new THREE.Object3D,E.position.y=-10,E.position.z=-t.random(20,40),pr(),Sr(),vr(),rr(),cr(),E.add($()),E.add($()),E.add($()),j&&E.add(N()),L&&Dr(),E.position.z=-t.random(40,80),E}this.buildScene=function(){return Fr()}}new AudioContext;document.getElementById("recorder");document.getElementById("player");var Zr=new THREE.Clock,br=new Array(35),jr=7,T,fr=[],tr=[],dr=[],yr=[],ir=new kr,lr=new ur;new Ar(ir.options);var Q=new xr,Tr=!1,gr=!1,Or=!1,qr=5,Hr=0;const _r=8;var Rr={RAINBOW:!1,NUM_TREES:_r*3,TREE_TYPE:"deciduous",GRASS_DENSITY:0,NIGHT_MODE:!0,EFFECT:!1,TREES:[]};const or=7680,Mr=742,mr=new THREE.Scene,Er=new THREE.OrthographicCamera(or/-2,or/2,Mr/2,Mr/-2,1,3e3);Er.position.x=0;Er.position.y=50;Er.position.z=300;Er.isPerspectiveCamera=!1;const hr=new THREE.WebGLRenderer;hr.setSize(window.innerWidth,window.innerHeight-10);hr.setPixelRatio(window.devicePixelRatio);document.body.appendChild(hr.domElement);hr.capabilities.isWebGL2===!1&&hr.extensions.has("ANGLE_instanced_arrays")===!1&&console.log("NOT SUPPORTED");const Vr=15,Kr=16,$r=16,Qr=new THREE.MeshBasicMaterial({color:13369344}),wr=new THREE.Mesh(new THREE.SphereGeometry(Vr,Kr,$r),Qr);wr.geometry.verticesNeedUpdate=!0;wr.geometry.normalsNeedUpdate=!0;function Jr(){for(let e=0;e<fr.length;e++)mr.remove(fr[e]);for(let e=0;e<tr.length;e++)mr.remove(tr[e]);for(fr=[],tr=[];fr.length<_r;){ir.getNewParameters(!1);let e=Q.randomInt(1,4);for(let r=0;r<e;r++){var m=ir.getTree(ir.options);m.foreground=!0,fr.push(m)}}for(;tr.length<_r*2;){ir.getNewParameters(!0);let e=Q.randomInt(1,4);for(let r=0;r<e*2;r++){var a=ir.getTree(ir.options);tr.length<_r*2&&(m.foreground=!1,tr.push(a))}}Q.shuffle(fr),Q.shuffle(tr),console.log(fr.length);for(let e=0;e<fr.length;e++){let r=fr[e],s=(or-300)/_r,f=-or/2+100+e*s;r.position.x=Q.random(f,f+s),r.position.z=-10-Q.random(150),r.position.y=-225-(r.position.z+10)/3,r.rotation.y=Math.PI/2,r.targetScale=8-(r.position.z+10)/-150,r.scale.x=r.scale.y=r.scale.z=.1,mr.add(r),Rr.TREES.push(r)}for(let e=0;e<tr.length;e++){let r=tr[e],s=(or-300)/tr.length,f=-or/2+100+e*s;r.position.x=Q.random(f-25,f+s+25),r.position.z=-350-Q.random(150),r.position.y=-100-(r.position.z+350)/3,r.rotation.y=Math.PI/2,r.targetScale=6-(r.position.z+350)/-150,r.scale.x=r.scale.y=r.scale.z=.1,mr.add(r),Rr.TREES.push(r)}console.log("forestOptions.TREES: "+Rr.TREES.length),dr=dr.concat(fr).concat(tr),Q.shuffle(dr)}console.log("LANDSCAPE:");console.log(ir.options);ir.options.LEAF_SIZE=1.6;ir.options.LEAF_W=1.15;let ro=0,Nr=-805,Pr=-100;var oo=new Yr(Rr,ir.options,or,ro,Pr,Nr);Jr();function ao(){console.log("bg init start"),mr.remove(T),T=oo.buildScene(),T.position.z=Nr,T.position.y=Pr,mr.add(T),console.log("bg init done.")}ao();no();function no(){for(let m=0;m<30;m++){let a=eo();a.speed=Q.random(25,50),a.position.x=m<15?-or/2+30:or/2-20,a.position.y=Q.random(-Mr/2-100,Mr/2+100),a.position.z=Er.position.z-10,yr.push(a),mr.add(a)}}function eo(){var m=new THREE.Shape;m.moveTo(25,25),m.bezierCurveTo(25,25,20,0,0,0),m.bezierCurveTo(-30,0,-30,35,-30,35),m.bezierCurveTo(-30,55,-10,77,25,95),m.bezierCurveTo(60,77,80,55,80,35),m.bezierCurveTo(80,35,80,0,50,0),m.bezierCurveTo(35,0,25,25,25,25);let a=lr.mixHexCols("#FF5577",lr.mixHexCols(T.skyCol,T.groundCol,.5,.5),.45,.55);var e=new THREE.ShapeGeometry(m,3),r=new THREE.MeshBasicMaterial({color:lr.parseHex(a)}),s=new THREE.Mesh(e,r);return s.rotation.z=Math.PI,s.scale.x=s.scale.y=s.scale.z=.3,s}treesButton.onclick=function(m){Or=!0,treesButton.style.fontWeight="bold"};bushButton.onclick=function(m){Tr=!Tr,bushButton.style.fontWeight=Tr?"bold":"normal"};cloudButton.onclick=function(m){gr=!gr,cloudButton.style.fontWeight=gr?"bold":"normal"};function Br(){requestAnimationFrame(Br),hr.render(mr,Er),to(),Or&&io()}Br();function to(){for(let m=0;m<yr.length;m++){let a=yr[m];a.position.y=a.position.y+a.speed,a.position.y>Mr/2+100&&(a.position.y=-Mr/2-100,a.speed=Q.random(25,50))}}function io(){if(Hr<dr.length){let m=dr[Hr];m.scale.x=m.scale.y=m.scale.z=m.scale.x+qr,m.scale.x>=m.targetScale&&(m.scale.x=m.scale.y=m.scale.z=m.targetScale,Hr++,console.log(Hr+" of "+dr.length+" grown."))}}function so(m){for(let a=0;a<T.bushes.length;a++)Tr&&m>10?T.bushes[a][0].scale.y=T.bushes[a][1]+m/50:T.bushes[a][0].scale.y=T.bushes[a][1]}function fo(m,a){for(let e=0;e<dr.length;e++)Lr(dr[e],m,a,0,dr[e].foreground)}function Lr(m,a,e,r,s){let f=a,v=e,b=.001*r*r*Math.sin(.2*Zr.getElapsedTime()),S=Q.randomSign(5e-4*r*r*f);if(m.branches.length!=0)for(let u=0;u<m.branches.length;u++){if(r>0&&(m.branches[u][0].scale.y=1+f/750,m.branches[u][0].rotation.x=m.branches[u][1]*(1+S)+b,m.branches[u][0].rotation.z=m.branches[u][2]*(1+S)),(s||v>30)&&m.branches[u][0].tip.leaves.length>0){let t=lr.variationsOn(m.branches[u][0].tip.leaves[0][1],2*v);for(let E=0;E<m.branches[u][0].tip.leaves.length;E++)m.branches[u][0].tip.leaves[E][0].material.color.set(t)}Lr(m.branches[u][0],a,e,r+1,s)}}new Array(10);function Ir(m){return m.length===0?void 0:m.reduce((r,s)=>r+s,0)/m.length}(function(){var m=new AudioContext;console.log("audio is starting up ...");var a=16384,e=null,r=null,s=null,f=null,v=null;navigator.getUserMedia||(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),navigator.getUserMedia?navigator.getUserMedia({audio:!0},function(t){u(t)},function(t){alert("Error capturing audio.")}):alert("getUserMedia not supported in this browser.");function b(t,E,A){var O=t.length,w=0;if(A==="time")for(;w<E&&w<O;w+=1)t[w]/128-1;else if(A==="frequency"){for(;w<E&&w<O;w+=1)t[w]/128-1;let P=Ir(t);br.shift(),br.push(P<jr?0:P);let L=Ir(br);if(fo(L,P),so(P),T!=null){let j=lr.variationsOn(T.skyCol,.05*L);T.skyCol=j;let G=j;T.sky.material.color.set(lr.parseHex(G));for(let o=0;o<T.clouds.length;o++){for(let n=0;n<T.clouds[o].children.length;n++)if(T.clouds[o].children[n].material.color.set(lr.parseHex(lr.brightenByAmt(G,T.clouds[o].brightness))),gr&&L>0)T.clouds[o].children[n].rotation.z=T.clouds[o].children[n].rotation.z+L/500;else{let d=T.clouds[o].children[n].rotation.z,M=Math.abs(Math.PI-T.clouds[o].children[n].rotation.z%Math.PI)>d?0:Math.PI;T.clouds[o].children[n].rotation.z=T.clouds[o].children[n].rotation.z%(Math.PI*2)+(M-d)/20}T.clouds[o].position.x=T.clouds[o].position.x-Math.max(.5,L/10),T.clouds[o].position.x<-or/2-500&&(T.clouds[o].position.x=or/2+500)}for(let o=0;o<T.looseLeaves.length;o++)T.looseLeaves[o][0].position.x=T.looseLeaves[o][0].position.x-(1+L/20*T.looseLeaves[o][4]),T.looseLeaves[o][0].position.y=T.looseLeaves[o][1]+150*T.looseLeaves[o][3]*Math.sin(.002*T.looseLeaves[o][0].position.x+T.looseLeaves[o][2]),T.looseLeaves[o][0].rotation.z=-Math.PI/4*Math.sin(.002*T.looseLeaves[o][0].position.x+T.looseLeaves[o][2]),T.looseLeaves[o][0].position.x<-or/2-500&&(T.looseLeaves[o][0].position.x=or/2+Q.random(or),T.looseLeaves[o][0].position.y=Q.random(-100,170),T.looseLeaves[o][1]=T.looseLeaves[o][0].position.y);for(let o=0;o<T.stars.length;o++)Math.random()<P/75?T.stars[o].scale.x=T.stars[o].scale.y=T.stars[o].scale.z=Q.random(1.2,2.2):T.stars[o].scale.x=T.stars[o].scale.y=T.stars[o].scale.z=1}}else throw new Error("ERROR - must pass time or frequency")}function S(t){t.inputBuffer.getChannelData(0)}function u(t){r=m.createGain(),r.connect(m.destination),r.gain.value=0,e=m.createMediaStreamSource(t),e.connect(r),s=m.createScriptProcessor(a,1,1),s.onaudioprocess=S,e.connect(s),document.getElementById("player").addEventListener("change",function(){var w=this.value;r.gain.value=w,console.log("curr_volume ",w)}),f=m.createScriptProcessor(2048,1,1),f.connect(r),v=m.createAnalyser(),v.smoothingTimeConstant=0,v.fftSize=2048,e.connect(v),v.connect(f);var E=v.frequencyBinCount,A=new Uint8Array(E),O=new Uint8Array(E);console.log("buffer_length "+E),console.log(hr.info.render),f.onaudioprocess=function(){v.getByteFrequencyData(A),v.getByteTimeDomainData(O),e.playbackState==e.PLAYING_STATE&&(b(A,5,"frequency"),b(O,5,"time"))}}})();
