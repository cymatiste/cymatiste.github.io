(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const f of s)if(f.type==="childList")for(const v of f.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&o(v)}).observe(document,{childList:!0,subtree:!0});function e(s){const f={};return s.integrity&&(f.integrity=s.integrity),s.referrerPolicy&&(f.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?f.credentials="include":s.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function o(s){if(s.ep)return;s.ep=!0;const f=e(s);fetch(s.href,f)}})();function xo(){var m=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],a=this;this.testVar="ohboy",this.variationsOn=function(o,s){var f=o;if(!a.isHex(o))console.warn("this version of the code doesn't support web color names anymore.  Please hexify it for now; sorry!");else{var v=a.hexToRgb(f),b=Math.random(),S=Math.random(),u=Math.random(),t=Math.max(0,Math.min(255,Math.round(v.r+b*s-s/2))),E=Math.max(0,Math.min(255,Math.round(v.g+S*s-s/2))),A=Math.max(0,Math.min(255,Math.round(v.b+u*s-s/2)));f=a.rgbToHex({r:t,g:E,b:A})}return f},this.valueOfHexCol=function(o){var s=a.hexToRgb(o);return(s.r+s.g+s.b)/3},this.palette8bit=[0,8388608,32768,8421376,128,8388736,32896,12632256,8421504,16711680,65280,16776960,255,16711935,65535,16777215,0,95,135,175,215,255,24320,24415,24455,24495,24535,24575,34560,34655,34695,34735,34775,34815,44800,44895,44935,44975,45015,45055,55040,55135,55175,55215,55255,55295,65280,65375,65415,65455,65495,65535,6225920,6226015,6226055,6226095,6226135,6226175,6250240,6250335,6250375,6250415,6250455,6250495,6260480,6260575,6260615,6260655,6260695,6260735,6270720,6270815,6270855,6270895,6270935,6270975,6280960,6281055,6281095,6281135,6281175,6281215,6291200,6291295,6291335,6291375,6291415,6291455,8847360,8847455,8847495,8847535,8847575,8847615,8871680,8871775,8871815,8871855,8871895,8871935,8881920,8882015,8882055,8882095,8882135,8882175,8892160,8892255,8892295,8892335,8892375,8892415,8902400,8902495,8902535,8902575,8902615,8902655,8912640,8912735,8912775,8912815,8912855,8912895,11468800,11468895,11468935,11468975,11469015,11469055,11493120,11493215,11493255,11493295,11493335,11493375,11503360,11503455,11503495,11503535,11503575,11503615,11513600,11513695,11513735,11513775,11513815,11513855,11523840,11523935,11523975,11524015,11524055,11524095,11534080,11534175,11534215,11534255,11534295,11534335,14090240,14090335,14090375,14090415,14090455,14090495,14114560,14114655,14114695,14114735,14114775,14114815,14124800,14124895,14124935,14124975,14125015,14125055,14135040,14135135,14135175,14135215,14135255,14135295,14145280,14145375,14145415,14145455,14145495,14145535,14155520,14155615,14155655,14155695,14155735,14155775,16711680,16711775,16711815,16711855,16711895,16711935,16736e3,16736095,16736135,16736175,16736215,16736255,16746240,16746335,16746375,16746415,16746455,16746495,16756480,16756575,16756615,16756655,16756695,16756735,16766720,16766815,16766855,16766895,16766935,16766975,16776960,16777055,16777095,16777135,16777175,16777215,526344,1184274,1842204,2500134,3158064,3815994,4473924,5131854,5789784,6447714,7105644,7763574,8421504,9079434,9737364,10395294,11053224,11711154,12369084,13027014,13684944,14342874,15000804,15658734],this.randomPastel=function(){var o=Math.floor(190+Math.random()*65),s=Math.floor(190+Math.random()*65),f=Math.floor(190+Math.random()*65),v={r:o,g:s,b:f};return a.rgbToHex(v)},this.randomBlue=function(){var o=Math.floor(0+Math.random()*150),s=Math.floor(0+Math.random()*150),f=Math.floor(0+Math.random()*255),v={r:o,g:s,b:f};return a.rgbToHex(v)},this.almostBW=function(){return Math.random()<.1?a.randomHex(!0):Math.random()<.5?a.randomPastel():a.randomDarkGrey()},this.almostBlue=function(){return Math.random()<.1?a.randomHex(!0):a.randomBlue()},this.randomHex=function(o){var s=Math.floor(Math.random()*255),f=Math.floor(Math.random()*255),v=Math.floor(Math.random()*255),b={r:s,g:f,b:v};return a.rgbToHex(b)},this.greyHex=function(o){return a.rgbToHex({r:o,g:o,b:o})},this.randomBright=function(){for(var o="#",s=Math.floor(Math.random()*3),f=0;f<6;f++)(f==0||f==1)&&s==0||(f==2||f==3)&&s==1||(f==4||f==5)&&s==2?o=o+"0":o=o+m[Math.floor(Math.random()*8)+8];return o},this.randomBlack=function(){var o=Math.max(0,Math.min(255,Math.floor(Math.random()*15))),s=Math.max(0,Math.min(255,Math.floor(Math.random()*15))),f=Math.max(0,Math.min(255,Math.floor(Math.random()*15)));return a.rgbToHex({r:o,g:s,b:f})},this.randomDarker=function(){var o=Math.floor(Math.random()*15),s=Math.floor(Math.random()*15),f=Math.floor(Math.random()*15);return a.rgbToHex({r:o,g:s,b:f})},this.rgbToHex=function(o){return"#"+e(o.r)+e(o.g)+e(o.b)},this.randomDarkGrey=function(){var o=15,s=o+Math.floor(Math.random()*o*4),f=Math.max(0,Math.min(255,Math.floor(s+Math.floor(Math.random()*o*2)-o))),v=Math.max(0,Math.min(255,Math.floor(s+Math.floor(Math.random()*o*2)-o))),b=Math.max(0,Math.min(255,Math.floor(s+Math.floor(Math.random()*o*2)-o)));return a.rgbToHex({r:f,g:v,b})},this.randomGrey=function(){var o=80,s=Math.floor(Math.random()*o*2),f=Math.max(0,Math.min(255,Math.floor(s+Math.floor(Math.random()*o)-o/2))),v=Math.max(0,Math.min(255,Math.floor(s+Math.floor(Math.random()*o)-o/2))),b=Math.max(0,Math.min(255,Math.floor(s+Math.floor(Math.random()*o)-o/2)));return a.rgbToHex({r:f,g:v,b})},this.randomDark=function(){var o=Math.floor(Math.random()*80),s=Math.floor(Math.random()*80),f=Math.floor(Math.random()*80);return a.rgbToHex({r:o,g:s,b:f})},this.brightenByAmt=function(o,s){var f;if(a.isHex(o))f=a.hexToRgb(o);else if(o.r!==void 0&&o.g!==void 0&&o.b!==void 0)f=o;else{console.warn("what kind of a color is "+o+" ?  Can't brighten.");return}return f.r=Math.max(0,Math.min(255,Math.floor(f.r+s))),f.g=Math.max(0,Math.min(255,Math.floor(f.g+s))),f.b=Math.max(0,Math.min(255,Math.floor(f.b+s))),a.isHex(o)?a.rgbToHex(f):(console.log("brightenByAmt returning in rgb format"),f)},this.intToHex=function(o){return"#"+o.toString(16)},this.parseHex=function(o){return typeof o=="number"?o:parseInt(o.replace(/#/g,"0x"))},a.greyFromCol=function(o){let s=a.hexToRgb(o),f=(s.r+s.g+s.b)/3;return s.r=s.g=s.b=Math.round(f),a.rgbToHex(s)},a.hexToInt=function(o){for(var s=0,f=1;f<o.length;f++)for(var v=o.charAt(f),b=0;b<m.length;b++)v==m[b]&&(s+=b*Math.pow(16,5-(f-1)));return s},this.hexToBgrInt=function(o){return a.hexToInt(a.rgbToBgrHex(a.hexToRgb(o)))},this.isHex=function(o){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(o)},this.webColourToHex=function(o){var s=document.createElement("div");s.style.color=o;var f=window.getComputedStyle(document.body.appendChild(s)).color.match(/\d+/g).map(function(b){return parseInt(b,10)});document.body.removeChild(s);var v=f.length>=3?"#"+((1<<24)+(f[0]<<16)+(f[1]<<8)+f[2]).toString(16).substr(1):!1;if(v)return v;throw o+" does not represent a known web colour."},this.nameToHex=function(o){if(a.isHex(o))return o;console.warn("what type of entity is this? "+o)},this.complimentaryRGB=function(o){return{r:255-o.r,g:255-o.g,b:255-o.b}},this.complimentaryHex=function(o){return a.rgbToHex(a.complimentaryRGB(a.hexToRgb(o)))},this.mixHexCols=function(o,s,f,v){var b=a.hexToRgb(o),S=a.hexToRgb(s),u={r:Math.floor(b.r*f+S.r*v),g:Math.floor(b.g*f+S.g*v),b:Math.floor(b.b*f+S.b*v)};return a.rgbToHex(u)},this.addHexCols=function(o,s,f,v){var b=a.hexToRgb(o),S=a.hexToRgb(s),u={r:Math.floor(Math.min(255,b.r+S.r)),g:Math.floor(Math.min(255,b.g+S.g)),b:Math.floor(Math.min(255,b.b+S.b))};return a.rgbToHex(u)},this.hexToRgb=function(o){var s=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;o=o.replace(s,function(b,S,u,t){return S+S+u+u+t+t});var f=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(o),v=f?{r:parseInt(f[1],16),g:parseInt(f[2],16),b:parseInt(f[3],16)}:null;return v==null&&console.warn("tried to rgbify hex "+o+" but it broke."),v},this.rgbToHex=function(o){return"#"+e(o.r)+e(o.g)+e(o.b)},this.rgbToBgrHex=function(o){return"#"+e(o.b)+e(o.g)+e(o.r)};function e(o){var s=o.toString(16);return s.length==1?"0"+s:s}}function co(){var m=this;this.randomInt=function(a,e){return Math.floor(m.random(a,e))},this.random=function(a,e){var o,s;return e==null?(o=0,s=a):(o=a,s=e),o+Math.random()*(s-o)},this.randomFrom=function(a){return a[Math.floor(Math.random()*a.length)]},this.randomSign=function(a){return a*(Math.random()>.5?1:-1)},this.shuffle=function(a){var e=0,o=0,s=null;for(e=a.length-1;e>0;e-=1)o=Math.floor(Math.random()*(e+1)),s=a[e],a[e]=a[o],a[o]=s;return a}}function yo(m){var a=this,e=new xo;new co;var o=m.RAINBOW;a.circleMesh=function(s,f){var v=new THREE.CircleGeometry(f,8),b=new THREE.MeshBasicMaterial({color:o?e.parseHex(e.randomHex()):e.parseHex(s)});return new THREE.Mesh(v,b)},a.sphereMesh=function(s,f){var v=new THREE.SphereGeometry(f,3,4),b=new THREE.MeshBasicMaterial({color:e.parseHex(s)});return new THREE.Mesh(v,b)},a.diamondMesh=function(s,f,v){var b=new THREE.Geometry,S=new THREE.Vector3(0,0,0),u=new THREE.Vector3(-f/2,v/4,0),t=new THREE.Vector3(0,v,0),E=new THREE.Vector3(f/2,v/4,0);b.vertices.push(S),b.vertices.push(u),b.vertices.push(t),b.vertices.push(E),b.faces.push(new THREE.Face3(0,1,2));var A,O=new THREE.MeshBasicMaterial({color:A});return new THREE.Mesh(b,O)}}function Wo(m){var a=this,e=new xo,o=new co;this.options=G(m);var s=new yo(a.options),f=a.options.RAINBOW,v=0;function b(){var r=Math.random();return r<.2?o.random(0,.02):r<.8?o.random(.02,.03):o.random(.03,.05)}function S(){return o.random(1,3)}function u(r,n){var d=r||[],l=n||0;if(l<a.options.MAX_DEPTH){for(var M=a.options.BRANCH_P-Math.min(a.options.BRANCH_P*.8,a.options.CHANCE_DECAY*l);v==0||d.length<a.options.MAX_BRANCHES_PER_NODE&&v<a.options.MAX_BRANCHES_TOTAL&&Math.random()<M;){var c=u([],l+1);d.push(c),v++}if(d==[])for(var p=o.randomInt(2,3),h=0;h<p.length;h++)d.push([])}return d}function t(r){var n=0,d=[];for(let l=0;l<r.length;l++)d.push(t(r[l]));for(let l=0;l<d.length;l++)d[l]>n&&(n=d[l]);return n+1}function E(r,n,d){var l=s.sphereMesh(r,n);return l.scale.x=d,l}function A(r){return r*(Math.PI/180)}function O(r,n,d,l,M,c){var p=r*o.random(1,1.4),h=Math.min(p,a.options.BRANCH_L);n==1&&(h=h/2);var x=function(ho,Ho){var Mo=M+ho/l*(c-M);return Mo},I=x(n),N=x(Math.max(0,n-1)),q=new THREE.CylinderGeometry(N,I,h,8),D=new THREE.SphereGeometry(N,2,2),k,U=(l-d)/l,P=1-U,Y=e.mixHexCols(a.options.COLOR_BTM,a.options.COLOR_TOP,U,P);k=f?e.parseHex(e.randomHex()):e.parseHex(Y);var oo=new THREE.MeshBasicMaterial({color:k}),J=new THREE.Mesh(q,oo);J.position.y=h/2;var $=new THREE.Mesh(D,oo),ao=new THREE.Object3D;ao.position.y=h,ao.add($);var V=new THREE.Object3D;return V.add(J),V.add(ao),V.tip=ao,V.length=h,V.tip.leaves=[],n<=2&&w(V.tip,o.randomInt(a.options.LEAF_DENSITY,a.options.LEAF_DENSITY),a.options.LEAF_COLS,a.options.LEAF_SIZE*2,0,0,a.options.LEAF_W),V}function w(r,n,d,l,M,c,p){for(let N=0;N<n;N++){var h=o.randomFrom(d),x=E(h,l,p),I=1.2;x.position.y+=o.random(-.5,2)*I+M,x.position.x+=o.randomSign(o.random(.75)*I+c),x.position.z+=o.randomSign(o.random(.75)*I+c),x.rotation.x=o.random(-Math.PI/2,Math.PI),x.rotation.y=o.random(-Math.PI/2,Math.PI),x.rotation.z=o.random(-Math.PI/2,Math.PI),r.rotation.y+=Math.PI*2/n,r.add(x),r.leaves.push([x,h,l,p])}}function B(r,n,d,l,M,c){var p=A(a.options.ANGLE_MIN+o.random(a.options.ANGLE_MAX-a.options.ANGLE_MIN));l<2&&(p=p/4);var h=O(n,d,l,M,a.options.BRANCH_R_MIN,c);h.branches=[];for(var x=0;x<r.length;x++){var I=B(r[x],n*a.options.LENGTH_MULT,t(r[x]),l+1,M,c),N=1.2-l/M;I.rotation.x=h.rotation.x+o.random(-p,p)*N,I.rotation.z=h.rotation.z+o.random(-p,p)*N,h.tip.add(I),h.branches.push([I,I.rotation.x,I.rotation.z])}return h}function L(r,n,d,l,M,c){for(var p=B(r,n,d,l,M,c),h=o.randomInt(3,10),x=o.random(Math.PI*2),I=e.parseHex(a.options.COLOR_BTM),N=0;N<h;N++){var q=o.random(c*.3,c*.7),D=o.random(n*.05,n*.25),k=new THREE.CylinderGeometry(q,.01,D,8),U=new THREE.MeshBasicMaterial({color:I}),P=new THREE.Mesh(k,U),Y=new THREE.Object3D;P.rotation.x=-Math.PI/2.4,P.position.z=D/2,Y.add(P),Y.rotation.y=x+N*(Math.PI*2/h),p.add(Y)}return p}this.getTree=function(r){v=0,Z(r);for(var n=[];n.length==0;)n=u();return L(n,r.BRANCH_L,t(n),0,t(n),r.BRANCH_R_MAX)};function Z(r){r!=null&&(a.options=r)}this.getNewParameters=function(){let r=G();return a.options=r,r};function G(r){let n=o.random(1.5,3),d=r==null?Math.random()<.7:r.NIGHT_MODE;var l=e.randomHex(),M=e.randomDark(),c=e.randomHex(),p=[];for(let I=0;I<8;I++)p.push(e.variationsOn(c,30));var h={RAINBOW:!1,NIGHT_MODE:d,BRANCH_R_MAX:n,BRANCH_R_MIN:.05,BRANCH_L:Math.max(o.random(6,10)),BRANCH_P:o.random(.72,.75),CHANCE_DECAY:b(),LENGTH_MULT:o.random(.85,.9),ANGLE_MIN:o.random(15,45),ANGLE_MAX:o.random(45,75),COLOR_TOP:l,COLOR_BTM:M,LEAF_COLS:p,LEAF_SIZE:S(),LEAF_DENSITY:3+o.randomInt(2),LEAF_W:o.random(.9,1.2),MAX_DEPTH:12,MAX_BRANCHES_TOTAL:400,MAX_BRANCHES_PER_NODE:o.randomInt(3,4)};if(h!==void 0)for(var x in r)h[x]!==void 0&&(h[x]=r[x]);return h}}function Uo(m){var a=this,e=new xo,o=new co;this.options=G(m);var s=new yo(a.options),f=a.options.RAINBOW,v=0;function b(){return .012}function S(){return o.random(1.25,2.5)}function u(r,n){var d=r||[],l=n||0;if(l<a.options.MAX_DEPTH){for(var M=a.options.BRANCH_P-Math.min(a.options.BRANCH_P*.8,a.options.CHANCE_DECAY*l);v==0||d.length<a.options.MAX_BRANCHES_PER_NODE&&v<a.options.MAX_BRANCHES_TOTAL&&Math.random()<M;){var c=u([],l+1);d.push(c),v++}if(d==[])for(var p=o.randomInt(2,3),h=0;h<p.length;h++)d.push([])}return d}function t(r){var n=0,d=[];for(let l=0;l<r.length;l++)d.push(t(r[l]));for(let l=0;l<d.length;l++)d[l]>n&&(n=d[l]);return n+1}function E(r,n,d){var l=s.sphereMesh(r,n);return l.scale.x=d,l}function A(r){return r*(Math.PI/180)}function O(r,n,d,l,M,c){var p;d<2?p=r/(4-2*d):d==2?p=r*2:p=r*o.random(1,1.4);var h=Math.min(p,a.options.BRANCH_L);n==1&&(h=h/2);var x=function(ho,Ho){let Mo=M+ho/l*(c-M);return Ho<2&&(Mo*=2-.5*Ho),Mo},I=x(n,d),N=x(Math.max(0,n-1),d+1),q=new THREE.CylinderGeometry(N,I,h,5),D=new THREE.SphereGeometry(N,2,2),k,U=(l-d)/l,P=1-U,Y=e.mixHexCols(a.options.COLOR_BTM,a.options.COLOR_TOP,U,P);k=f?e.parseHex(e.randomHex()):e.parseHex(Y);var oo=new THREE.MeshBasicMaterial({color:k}),J=new THREE.Mesh(q,oo);J.position.y=h/2;var $=new THREE.Mesh(D,oo),ao=new THREE.Object3D;ao.position.y=h,d>0&&ao.add($);var V=new THREE.Object3D;return V.add(J),V.add(ao),V.tip=ao,V.length=h,V.tip.leaves=[],n<=2&&(w(V.tip,1,a.options.LEAF_COLS,a.options.LEAF_SIZE,0,0,a.options.LEAF_W),w(V.tip,a.options.LEAF_DENSITY,a.options.LEAF_COLS,a.options.LEAF_SIZE,a.options.LEAF_SIZE*2,a.options.LEAF_SIZE*2,a.options.LEAF_W)),V}function w(r,n,d,l,M,c,p){for(let N=0;N<n;N++){var h=o.randomFrom(d),x=E(h,l,p),I=1.2;x.position.y+=o.random(-.5,2)*I+M,x.position.x+=o.randomSign(o.random(.75)*I+c),x.position.z+=o.randomSign(o.random(.75)*I+c),x.rotation.x=o.random(-Math.PI/2,Math.PI),x.rotation.y=o.random(-Math.PI/2,Math.PI),x.rotation.z=o.random(-Math.PI/2,Math.PI),r.rotation.y+=Math.PI*2/n,r.add(x),r.leaves.push([x,h,l,p])}}function B(r,n,d,l,M,c){A(a.options.ANGLE_MIN+o.random(a.options.ANGLE_MAX-a.options.ANGLE_MIN));var p=O(n,d,l,M,a.options.BRANCH_R_MIN,c);p.branches=[],o.random(Math.PI*2);for(var h=0;h<r.length;h++){var x=B(r[h],n*a.options.LENGTH_MULT,t(r[h]),l+1,M,c),I=5;const N=A(l<2?-a.options.ANGLE_MIN/12:a.options.ANGLE_MIN/2),q=A(l<2?-a.options.ANGLE_MAX/12:a.options.ANGLE_MAX/2),D=1,k=o.randomInt(2,5);x.rotation.y=o.random(Math.PI/32),x.rotation.x=o.random(-1,1)*o.random(N/k,q/k)*D*I,p.tip.add(x),p.branches.push([x,x.rotation.x,x.rotation.z])}return p}function L(r,n,d,l,M,c){var p=B(r,n,d,l,M,c),h=o.randomInt(3,7);o.random(Math.PI*2);for(var x=e.parseHex(a.options.COLOR_BTM),I=0;I<h;I++){var N=o.random(c*2/(h*2),c*3/h),q=o.random(n*.5,n*.75),D=new THREE.CylinderGeometry(N,.01,q,8),k=new THREE.MeshBasicMaterial({color:x}),U=new THREE.Mesh(D,k),P=new THREE.Object3D;U.position.z=q/2+N,U.position.y=0,U.rotation.x=-Math.PI/2.5,P.add(U),P.rotation.y=I*(Math.PI*2/h),p.add(P)}return p.rotation.y=o.random(Math.PI*2),p}this.getTree=function(r){v=0,Z(r);for(var n=[];n.length==0;)n=u();return L(n,r.BRANCH_L,t(n),0,t(n),r.BRANCH_R_MAX)};function Z(r){r!=null&&(a.options=r)}this.getNewParameters=function(r=!1){let n=G({},r);return a.options=n,n};function G(r,n=!1){let d=o.random(2,3),l=r==null?Math.random()<.7:r.NIGHT_MODE;var M=e.randomHex(),c=e.randomDark(),p=e.randomHex(),h=[];for(let N=0;N<8;N++)h.push(e.variationsOn(p,30));var x={RAINBOW:!1,NIGHT_MODE:l,BRANCH_R_MAX:d,BRANCH_R_MIN:.05,BRANCH_L:o.random(7,11),BRANCH_P:n?o.random(.7,.75):o.random(.73,.78),CHANCE_DECAY:b(),LENGTH_MULT:o.random(.88,.92),ANGLE_MIN:o.random(15,30),ANGLE_MAX:o.random(40,60),COLOR_TOP:M,COLOR_BTM:c,LEAF_COLS:h,LEAF_SIZE:S(),LEAF_DENSITY:n?2:3+o.randomInt(3),LEAF_W:o.random(.9,1.2),MAX_DEPTH:n?10:11,MAX_BRANCHES_TOTAL:n?100:300,MAX_BRANCHES_PER_NODE:2};if(x!==void 0)for(var I in r)x[I]!==void 0&&(x[I]=r[I]);return x}}function Yo(m){var a=new xo,e=new co;this.options=G(m);var o=this.options,s=new yo(o),f=o.RAINBOW;function v(){var r=Math.random();return r<.2?e.random(.1,.3):r<.5?e.random(.4,.9):r<.95?e.random(1,1.4):e.random(1.5,2.8)}function b(){var r=Math.random();return r<.3?e.random(.01,.03):r<.9?e.random(.03,.06):e.random(.06,.07)}function S(){var r=Math.random();return r<.33?e.random(.15,.4):r<.7?e.random(.4,.8):r<.9?e.random(.8,1):e.random(1,1.4)}function u(r,n,d){for(var l=0;l<d;l++){for(var M=[],c=0;c<o.MAX_BRANCHES_PER_NODE;c++)Math.random()<o.BRANCH_P&&M.push([]);r.push(M)}return r}function t(r){var n,d=0,l=[];for(n=0;n<r.length;n++)l.push(t(r[n]));for(n=0;n<l.length;n++)l[n]>d&&(d=l[n]);return d+1}function E(r,n,d){var l=s.diamondMesh(r,n);return l.scale.x=d,l}function A(r){return r*(Math.PI/180)}function O(r,n,d,l,M,c,p){var h=r*e.random(1,1.4);Math.min(h,o.BRANCH_L);var x=function(ao,V){var ho=M+ao/l*(c-M);return ho};d<=1&&(h*=2);var I=x(n),N=x(Math.max(0,n-1)),q=new THREE.CylinderGeometry(N,I,h,8),D=new THREE.SphereGeometry(N,2,2),k=(l-d)/l,U=1-k;f?a.randomHex():a.mixHexCols(o.COLOR_BTM,o.COLOR_TOP,k,U),console.log("rootColInt: "+rootColInt);var P=new THREE.MeshBasicMaterial({color:a.parseHex(rootColInt)}),Y=new THREE.Mesh(q,P);Y.position.y=h/2;var oo=new THREE.Mesh(D,P),J=new THREE.Object3D;J.position.y=h,J.add(oo);var $=new THREE.Object3D;return $.add(Y),$.add(J),$.tip=J,$.length=h,n==1&&w($.tip,o.LEAF_DENSITY,o.LEAF_COLS,o.LEAF_SIZE,0,0,o.LEAF_W),$}function w(r,n,d,l,M,c,p){var h=e.random(Math.PI*2);for(i=0;i<n;i++){var x=new THREE.Object3D,I=e.randomFrom(d),N=E(I,l,p);N.position.y=l/2,N.rotation.x=e.random(-o.ANGLE_MAX,-o.ANGLE_MIN),x.add(N),x.rotation.y=h+i*Math.PI*2/n,x.position.y-=e.random(0,o.BRANCH_L/2),r.add(x)}}function B(r,n,d,l,M,c,p){var h=e.random(Math.PI*2);t(r)==M;var x=Math.min(o.BRANCH_R_MIN,c*.5),I=O(.1,M,l,M,x,c,COLOR_BTM),N=I;d==1?I.tip.rotation.x=A(125):d>1&&(I.tip.rotation.x=A(65));var q=A(p?180+o.ANGLE_MIN/2:o.ANGLE_MIN/2),D=A(p?180+o.ANGLE_MAX/2:o.ANGLE_MAX/2),k=n*o.LENGTH_MULT;console.log("     d     "+d+",     ftd "+M);for(var U=d<=1?M:Math.min(4,M),P=0;P<U;P++){console.log("-------------trunkpiece "+P);var Y=O(n,r.length-P,P,U,x*((r.length-P)/r.length),c*((r.length-P)/r.length),COLOR_BTM);if(Y.rotation.x=d==0?e.random(-.1,.1):d>1&&P>1?-e.random(-q/10,-D/10):e.random(-q/10,-D/10),N.tip.add(Y),h=e.random(Math.PI*2),P>0&&d<2){for(var oo=0;oo<r[P].length;oo++)if(!(Math.random()>1/Math.log(d+3))){console.log("---------=== branch "+oo),k=n*((r.length-P)/r.length)/3;var J=B(r,k,d+1,P,M-1,c*((r.length-P)/r.length)/3,!1),$=new THREE.Object3D;$.rotation.y=h+oo*Math.PI*2/r[P].length,J.position.y=e.random(-n/3,n/3),$.add(J),N.tip.add($)}}N=Y}return I}function L(r,n,d,l,M,c){for(var p=B(r,n,0,l,M,c,!0),h=e.randomInt(3,10),x=e.random(Math.PI*2),I=f?a.parseHex(a.randomHex()):a.parseHex(o.COLOR_BTM),N=0;N<h;N++){var q=e.random(c*.3,c*.7),D=e.random(n*.02,n*.1),k=new THREE.CylinderGeometry(q,.01,D,8),U=new THREE.MeshBasicMaterial({color:a.parseHex(I)}),P=new THREE.Mesh(k,U),Y=new THREE.Object3D;P.rotation.x=-Math.PI/2.4,P.position.z=D/2+c/2*.9,Y.add(P),Y.rotation.y=x+N*(Math.PI*2/h),p.add(Y)}return p}this.getTree=function(r){Z(r);var n=[];return n=u([],0,o.MAX_DEPTH),L(n,o.BRANCH_L,n.length,0,n.length,o.BRANCH_R_MAX)};function Z(r){_o=this.options=r}function G(r){var n=5*v(),d=a.randomHex(),l=r.NIGHT_MODE?a.brightenByAmt(a.randomHex(),-60):a.variationsOn(a.randomHex(),80),M=[];for(let h=0;h<8;h++)M.push(a.variationsOn(l,30));var c={RAINBOW:!1,NIGHT_MODE:!1,BRANCH_R_MAX:n,BRANCH_R_MIN:n*e.random(.03),TRUNK_R_MAX:e.random(5,25),TRUNK_R_MIN:e.random(2),BRANCH_L:e.random(3,7),BRANCH_P:e.random(.85,.95),CHANCE_DECAY:b(),LENGTH_MULT:e.random(.85,.95),ANGLE_MIN:e.random(100,110),ANGLE_MAX:e.random(120,135),COLOR_BTM:d,COLOR_TOP:a.variationsOn(d,180),LEAF_COLS:M,LEAF_SIZE:S(),LEAF_DENSITY:e.randomInt(24),LEAF_W:e.random(.1,.2),MAX_DEPTH:e.random(8,20),MAX_BRANCHES_TOTAL:9999,MAX_BRANCHES_PER_NODE:e.randomInt(3,6),LEAF_DENSITY:e.randomInt(24)};for(var p in r)c[p]!==void 0&&(c[p]=r[p]);return console.log("decay "+c.CHANCE_DECAY+`
max depth `+c.MAX_DEPTH+`
branches per node `+c.MAX_BRANCHES_PER_NODE),c}}function jo(m){var a=new xo,e=new co;this.options=E(m);var o=this.options;function s(A,O,w){var B=f(A,O);return B.scale.x=w,B}function f(A,O){var w=new THREE.CircleGeometry(O,8),B=new THREE.MeshBasicMaterial({color:a.parseHex(A)});return new THREE.Mesh(w,B)}function v(A,O,w,B){var L=new THREE.CylinderGeometry(O,w,B,8),Z=a.parseHex(A);for(i=0;i<L.faces.length;i++)L.faces[i].color.setHex(Z);var G=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,overdraw:.5});return new THREE.Mesh(L,G)}function b(A){return A*(Math.PI/180)}function S(A,O,w){var B=v(o.STEM_COL,.01,.02,O),L=.3,Z=.2;console.log("frond with "+w+" leaves of length "+L);for(var G=0;G<w;G++){var r=L*((w-G)/w),n=s(A,r,Z),d=s(A,r,Z);n.rotation.z=-Math.PI/2,n.position.x=-L/2,n.position.y=G*(O/w),d.rotation.z=Math.PI/2,d.position.x=L/2,d.position.y=G*(O/w),B.add(n),B.add(d)}return B}function u(){var A=new THREE.Object3D;A.tip=A;var O=e.randomInt(o.MAX_DEPTH/2,o.MAX_DEPTH);e.randomInt(0,5);for(var w=[A],B=.1,L=1,Z=e.random(2,5),G=e.randomFrom(o.LEAF_COLS),r=e.random(o.MIN_FLOP,o.MAX_FLOP),n=0;n<O;n++){var d=new THREE.Object3D,l=L-n*.03,M=v(o.STEM_COL,B-(n+1)*.005,B-n*.005,l);M.y=l/2;var c=new THREE.Object3D;c.position.y=l,M.add(c),d.add(M),d.tip=c,d.rotation.x=r;var p=w[w.length-1];if(p.tip.add(d),n>Z){var h=O*L*((O-n)/O),x=S(G,h,O-n),I=S(G,h,O-n);x.rotation.z=-Math.PI/2+r/2,I.rotation.z=Math.PI/2+r/2,d.add(x),d.add(I)}w.push(d)}return A}function t(){for(var A=new THREE.Object3D,O=e.random(2,5),w=0;w<O;w++){var B=u();B.rotation.y=w*(Math.PI*2)/O,A.add(B)}return A}this.getFern=function(A){return t()};function E(A){var O=A||a.randomHex(),w=a.variationsOn(O,10),B=[];for(let Z=0;Z<8;Z++)B.push(a.variationsOn(w,20));var L={STEM_COL:O,MAX_WIDTH:e.randomInt(8,20),MAX_DEPTH:20,MIN_FLOP:b(3),MAX_FLOP:b(15),LEAF_COLS:B};return L}}function Zo(m,a,e,o,s,f){var v=e,b=s,S=f,u=new xo,t=new co;new jo;var E,A=m,O=a,w=A==null?!1:A.RAINBOW,B=t.random(.3,.8),L=A==null?Math.random()<.25:A.NIGHT_MODE,Z=Math.random()<.25;O.NIGHT_MODE=L;var G=A==null?t.randomInt(50,200):A.NUM_TREES,r,n,d,l,M,c=-650,p=-690;I();var h=new Wo(O);new Yo(O);function x(){var _=Math.random();return _<.33?t.random(.15,.4):_<.7?t.random(.4,.8):_<.9?t.random(.8,1):t.random(1,1.4)}function I(){r=L?u.variationsOn("#4d6876",120):u.variationsOn("#bdeff1",150),n=L?u.variationsOn("#40523c",80):u.brightenByAmt(u.variationsOn("#78836e",150),t.randomInt(-25,-75)),d=[],l=[],M=[];var _=L?n:u.brightenByAmt(n,t.random(-30,10)),H=u.greyHex(L?t.randomInt(20,60):t.randomInt(90,130)),R=u.mixHexCols(H,n,.7,.3);R=u.mixHexCols(R,r,.8,.2),M[0]=R;for(let y=0;y<8;y++)d.push(u.variationsOn(n,15)),l.push(u.variationsOn(_,40))}function N(){var _=new THREE.Object3D,H=.5,R=new THREE.Vector3(0,0,-30);t.random(1,3);for(var y=t.random(1,5),C=0;C<400/H;C++){for(var z=t.random(10,20),g=t.random(1,3),F=.07,j=.3,K=new THREE.Object3D,W=0;W<z;W++){var X=t.random(-g,g),eo=F+j*((g-Math.abs(X))/g),so=Do(M[0],eo);so.position.x=X,so.position.z=t.random(-g,g),K.add(so)}K.position.x=y*t.random(1,2)-y/2,K.position.z=R.z+C*H,_.add(K)}return _}function q(_,H,R){var y=D(_,H,4);return y.scale.x=R,y}function D(_,H,R,y=1){var C=new THREE.CircleGeometry(H,R),z=new THREE.MeshBasicMaterial({color:u.parseHex(_),opacity:y,transparent:y<1}),g=new THREE.Mesh(C,z);return g}function k(_,H){var R=new THREE.SphereGeometry(H,5,4,0,Math.PI*2,0,Math.PI/2),y=w?u.parseHex(u.randomHex()):u.parseHex(_),C=new THREE.MeshBasicMaterial({color:y});return new THREE.Mesh(R,C)}function U(_,H){return new THREE.SphereGeometry(_,16,8),new THREE.MeshBasicMaterial({color:H}),k(H,_)}function P(){var _=[],H=u.mixHexCols(u.randomHex(),h.options.COLOR_BTM,.3,.7);H=u.mixHexCols(H,n,.3,.7);for(let R=0;R<4;R++)_.push(u.variationsOn(H,20));return _}function Y(_,H,R,y){var C=new THREE.Object3D;for(let g=0;g<_*4;g++){var z=new THREE.Object3D;V(z,t.randomInt(5,12),R,y,0,0,y),z.position.x=t.random(-H,H),z.position.z=t.random(-H,H),z.position.y=g%2==0?_:t.random(_,_*.7+_-_*Math.abs(z.position.x)/H),C.add(z)}return C.position.y=-.5,C.scale.x=C.scale.y=C.scale.z=t.random(1,1.5),C}function oo(){E.bushes=[],t.random(.4,1);var _=t.randomInt(8,25),H=P(),R=t.random(h.options.LEAF_SIZE,h.options.LEAF_SIZE*2);t.random(.7,1);var y;let C=[];for(let X=0;X<8;X++)C.push(u.variationsOn(u.randomHex(),30));for(var z=[],y=0;y<H.length;y++)z.push(u.brightenByAmt(u.mixHexCols(H[y],r,.8,.2),-10));for(let X=0;X<30;X++){var g=Y(t.random(3,5),_,H,R*2);let eo=t.randomFrom(A.TREES);g.position.x=eo.position.x-t.random(-150,150),g.position.z=eo.position.z-S+t.random(0,100),g.position.y=eo.position.y-b+30,Math.random()<.4&&(g.position.x=g.position.x+t.random(-1e3,1e3),g.position.z=g.position.z+t.random(-200,200)),E.add(g),E.bushes.push([g,g.scale.y])}for(let X=0;X<50;X++){var g=Y(t.random(10,30),200,z,R*3.5);g.position.z=t.random(c,p),g.position.x=t.randomSign(t.random(0,v/2)),g.position.y=55-R*3,E.add(g),E.bushes.push([g,g.scale.y])}let F=u.parseHex(u.mixHexCols(n,r,.3,.7));for(let X=0;X<30;X++){let eo=t.random(-v/2-100,v/2+100);for(let so=0;so<500;so++){var j=new THREE.CircleGeometry(10,4),K=new THREE.MeshBasicMaterial({color:F}),W=new THREE.Mesh(j,K);W.position.z=-890;let no=t.random(350,500),Oo=t.random(-no,no);W.position.x=eo+Oo,W.position.y=t.random(50,200)-50*Math.abs(Oo)/no,W.scale.x=W.scale.y=t.random(.5,3),E.add(W)}}}function J(){for(var _=[],H=u.randomBright(),R=0;R<4;R++)_.push(u.variationsOn(H,50));return _}function $(){var _=J(),H=t.randomInt(50,150),R=new THREE.Object3D,y=5,C=t.random(1.25,1.75);t.random(-50,-100);var z=t.random(-50,-200),g=t.random(-v/2,v/2),F=v/2,j=C*t.random(.2,.3),K=t.randomFrom(_),W=K,X=Math.PI*t.random(1.25,1.5);let eo=D(W,j,4);for(var so=0;so<H;so++){let no=ao(y,eo,j,X);no.position.z=900+so*t.random(-z/3,z*(2/3)),no.position.x=g+t.random(-F/2,F/2),no.position.y=t.random(-80,0),no.rotation.x+=t.random(-.3,.3),no.rotation.z+=t.random(-.3,.3),no.scale.x=no.scale.y=no.scale.z=t.random(15,25),R.add(no)}return R}function ao(_,H,R,y){for(var C=new THREE.Object3D,z=0;z<_;z++){var g=new THREE.Object3D,F=H.clone();F.rotation.x=y,F.position.z=R/1.5,F.scale.x=2/_,g.add(F),g.position.y=1.1,g.rotation.y=z*(Math.PI*2/_),C.scale.x=C.scale.y=C.scale.z=1,C.add(g)}return C}function V(_,H,R,y,C,z,g){var F=t.randomFrom(R);for(let K=0;K<H;K++){var j=q(F,y,g);j.position.y+=t.random(0,2)+C,j.position.x+=t.randomSign(t.random(.75)+z),j.position.z+=t.randomSign(t.random(.75)+z),j.rotation.x=t.random(-Math.PI/2,Math.PI),j.rotation.y=t.random(-Math.PI/2,Math.PI),j.rotation.z=t.random(-Math.PI/2,Math.PI),_.rotation.y+=Math.PI*2/H,_.add(j)}}function ho(){for(var _=t.randomInt(14,24),H=400,R=.08,y=0;y<_;y++){var C=new THREE.Object3D,z=3+t.randomInt(12),g=t.randomInt(-v/2,v/2),F=t.random(160,700),j=t.randomInt(15,30),K=u.brightenByAmt(r,j);C.position.x=g,C.position.y=F;for(var W=0;W<z;W++){var X=D(K,t.random(H*.5,H),6,.5);X.scale.y=t.random(R),X.scale.x=t.random(.3,.7),X.position.z=-900+(5-5*(u.valueOfHexCol(K)/255));var eo=H*R*1.5;X.position.y=t.random(-eo/2,eo/2),X.position.x=t.random(-H/4,H/4),C.add(X),C.brightness=j}E.add(C),E.clouds.push(C)}}function Ho(){t.randomInt(G*.5,G*1.5);var _=x();t.random(400,500);var H=t.random(150,250)/G;const R=new THREE.PlaneGeometry(8e3,1500,1,1),y=new THREE.MeshBasicMaterial({color:u.parseHex(r)}),C=new THREE.Mesh(R,y);C.position.z=-925,C.position.y=-50,E.skyCol=r,E.groundCol=n,E.sky=C,E.add(C),E.looseLeaves=[],E.clouds=[];var z=new THREE.SphereGeometry(30,4,4),g=new THREE.MeshBasicMaterial({color:u.parseHex(n)}),F=new THREE.Mesh(z,g);F.position.x=0,F.position.y=-100,F.position.z=-200,F.scale.x=1e3,F.scale.y=.005,F.scale.z=10,F.rotation.x=Math.PI/5,E.add(F);var j=[];for(let W=0;W<G*2;W++)j.push(W%G*H);j=t.shuffle(j);for(let W=0;W<G*12;W++){var K=new THREE.Object3D;K.position.x=t.randomSign(t.random(3,40)),K.position.z=W+t.random(-150,150),V(K,t.randomInt(0,15),l,_,0,0,B),E.add(K)}}function Mo(){let _=[];for(let R=0;R<d.length;R++)_.push(u.variationsOn(u.brightenByAmt(d[R],50),25));let H=q(t.randomFrom(_),O.LEAF_SIZE*2.25,O.LEAF_W*2.5);for(let R=0;R<50;R++){let y=H.clone();y.position.x=t.random(-v/2-100,v/2+500),y.position.y=t.random(-100,170),y.position.z=t.random(300,900),E.looseLeaves.push([y,y.position.y,t.random(1e3),t.random(-1,1),t.random(1,3)]),E.add(y)}}function zo(){var _=400;E.hills=[];var H=10;let R=[];for(var y=0;y<d.length;y++)R.push(U(H,d[y]));for(var y=0;y<_;y++){let g=R[y%R.length].clone();g.scale.x=t.random(50,150),g.scale.y=t.random(3,8),g.scale.z=t.random(30,80);var C=v*2;g.position.z=t.random(100,-500),g.position.x=t.random(-C/2-5,C/2+5),g.position.y=-120-g.position.z/3,E.hills.push(g),E.add(g)}}function Do(_,H){var R=D(_,H,8);return R.rotation.x=-Math.PI/2,R}function Fo(){var _=u.mixHexCols("#FFFFFF",r,.7,.3),H=D(_,2,4);return H}function Xo(){var _=300,H=new THREE.Object3D;E.stars=[];for(var R=Fo(),y=0;y<_;y++){var C=R.clone();C.scale.x=C.scale.y=C.scale.z=t.random(1.5,3.5),H.add(C),C.position.x=t.random(-v/2,v/2),C.position.y=t.random(-300,600),C.position.z=-895,E.stars.push(C)}E.dome=H,E.add(H)}function ko(){return E=new THREE.Object3D,E.position.y=-10,E.position.z=-t.random(20,40),Ho(),zo(),ho(),oo(),Mo(),E.add($()),E.add($()),E.add($()),Z&&E.add(N()),L&&Xo(),E.position.z=-t.random(40,80),E}this.buildScene=function(){return ko()}}new AudioContext;document.getElementById("recorder");document.getElementById("player");var qo=new THREE.Clock,Co=new Array(35),Vo=7,T,fo=[],to=[],lo=[],Io=[],io=new Uo,mo=new xo;new yo(io.options);var Q=new co,Ro=!1,Ao=!1,No=!1,Ko=5,go=0;const To=8;var bo={RAINBOW:!1,NUM_TREES:To*3,TREE_TYPE:"deciduous",GRASS_DENSITY:0,NIGHT_MODE:!0,EFFECT:!1,TREES:[]};const ro=7680,Eo=742,vo=new THREE.Scene,po=new THREE.OrthographicCamera(ro/-2,ro/2,Eo/2,Eo/-2,1,3e3);po.position.x=0;po.position.y=50;po.position.z=300;po.isPerspectiveCamera=!1;const uo=new THREE.WebGLRenderer;uo.setSize(window.innerWidth,window.innerHeight-10);uo.setPixelRatio(window.devicePixelRatio);document.body.appendChild(uo.domElement);uo.capabilities.isWebGL2===!1&&uo.extensions.has("ANGLE_instanced_arrays")===!1&&console.log("NOT SUPPORTED");const $o=15,Qo=16,Jo=16,or=new THREE.MeshBasicMaterial({color:13369344}),Bo=new THREE.Mesh(new THREE.SphereGeometry($o,Qo,Jo),or);Bo.geometry.verticesNeedUpdate=!0;Bo.geometry.normalsNeedUpdate=!0;function rr(){for(let e=0;e<fo.length;e++)vo.remove(fo[e]);for(let e=0;e<to.length;e++)vo.remove(to[e]);for(fo=[],to=[];fo.length<To;){io.getNewParameters(!1);let e=Q.randomInt(1,4);for(let o=0;o<e;o++){var m=io.getTree(io.options);m.foreground=!0,fo.push(m)}}for(;to.length<To*2;){io.getNewParameters(!0);let e=Q.randomInt(1,4);for(let o=0;o<e*2;o++){var a=io.getTree(io.options);to.length<To*2&&(m.foreground=!1,to.push(a))}}Q.shuffle(fo),Q.shuffle(to),console.log(fo.length);for(let e=0;e<fo.length;e++){let o=fo[e],s=(ro-300)/To,f=-ro/2+100+e*s;o.position.x=Q.random(f,f+s),o.position.z=-10-Q.random(150),o.position.y=-225-(o.position.z+10)/3,o.rotation.y=Math.PI/2,o.targetScale=8-(o.position.z+10)/-150,o.scale.x=o.scale.y=o.scale.z=.1,vo.add(o),bo.TREES.push(o)}for(let e=0;e<to.length;e++){let o=to[e],s=(ro-300)/to.length,f=-ro/2+100+e*s;o.position.x=Q.random(f-25,f+s+25),o.position.z=-350-Q.random(150),o.position.y=-100-(o.position.z+350)/3,o.rotation.y=Math.PI/2,o.targetScale=6-(o.position.z+350)/-150,o.scale.x=o.scale.y=o.scale.z=.1,vo.add(o),bo.TREES.push(o)}console.log("forestOptions.TREES: "+bo.TREES.length),lo=lo.concat(fo).concat(to),Q.shuffle(lo)}console.log("LANDSCAPE:");console.log(io.options);io.options.LEAF_SIZE=1.6;io.options.LEAF_W=1.15;let ar=0,Po=-805,Lo=-100;var nr=new Zo(bo,io.options,ro,ar,Lo,Po);rr();function er(){console.log("bg init start"),vo.remove(T),T=nr.buildScene(),T.position.z=Po,T.position.y=Lo,vo.add(T),console.log("bg init done.")}er();tr();function tr(){for(let m=0;m<30;m++){let a=ir();a.speed=Q.random(25,50),a.position.x=m<15?-ro/2+30:ro/2-20,a.position.y=Q.random(-Eo/2-100,Eo/2+100),a.position.z=po.position.z-10,Io.push(a),vo.add(a)}}function ir(){var m=new THREE.Shape;m.moveTo(25,25),m.bezierCurveTo(25,25,20,0,0,0),m.bezierCurveTo(-30,0,-30,35,-30,35),m.bezierCurveTo(-30,55,-10,77,25,95),m.bezierCurveTo(60,77,80,55,80,35),m.bezierCurveTo(80,35,80,0,50,0),m.bezierCurveTo(35,0,25,25,25,25);let a=mo.mixHexCols("#FF5577",mo.mixHexCols(T.skyCol,T.groundCol,.5,.5),.45,.55);var e=new THREE.ShapeGeometry(m,3),o=new THREE.MeshBasicMaterial({color:mo.parseHex(a)}),s=new THREE.Mesh(e,o);return s.rotation.z=Math.PI,s.scale.x=s.scale.y=s.scale.z=.3,s}audioButton.onclick=function(m){mr(),audioButton.style.fontWeight="bold"};treesButton.onclick=function(m){No=!0,treesButton.style.fontWeight="bold"};bushButton.onclick=function(m){Ro=!Ro,bushButton.style.fontWeight=Ro?"bold":"normal"};cloudButton.onclick=function(m){Ao=!Ao,cloudButton.style.fontWeight=Ao?"bold":"normal"};function So(){requestAnimationFrame(So),uo.render(vo,po),sr(),No&&fr()}So();function sr(){for(let m=0;m<Io.length;m++){let a=Io[m];a.position.y=a.position.y+a.speed,a.position.y>Eo/2+100&&(a.position.y=-Eo/2-100,a.speed=Q.random(25,50))}}function fr(){if(go<lo.length){let m=lo[go];m.scale.x=m.scale.y=m.scale.z=m.scale.x+Ko,m.scale.x>=m.targetScale&&(m.scale.x=m.scale.y=m.scale.z=m.targetScale,go++,console.log(go+" of "+lo.length+" grown."))}}function dr(m){for(let a=0;a<T.bushes.length;a++)Ro&&m>10?T.bushes[a][0].scale.y=T.bushes[a][1]+m/50:T.bushes[a][0].scale.y=T.bushes[a][1]}function lr(m,a){for(let e=0;e<lo.length;e++)Go(lo[e],m,a,0,lo[e].foreground)}function Go(m,a,e,o,s){let f=a,v=e,b=.001*o*o*Math.sin(.2*qo.getElapsedTime()),S=Q.randomSign(5e-4*o*o*f);if(m.branches.length!=0)for(let u=0;u<m.branches.length;u++){if(o>0&&(m.branches[u][0].scale.y=1+f/750,m.branches[u][0].rotation.x=m.branches[u][1]*(1+S)+b,m.branches[u][0].rotation.z=m.branches[u][2]*(1+S)),(s||v>30)&&m.branches[u][0].tip.leaves.length>0){let t=mo.variationsOn(m.branches[u][0].tip.leaves[0][1],2*v);for(let E=0;E<m.branches[u][0].tip.leaves.length;E++)m.branches[u][0].tip.leaves[E][0].material.color.set(t)}Go(m.branches[u][0],a,e,o+1,s)}}new Array(10);function wo(m){return m.length===0?void 0:m.reduce((o,s)=>o+s,0)/m.length}var mr=function(){var m=new AudioContext;console.log("audio is starting up ...");var a=16384,e=null,o=null,s=null,f=null,v=null;navigator.getUserMedia||(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),navigator.getUserMedia?navigator.getUserMedia({audio:!0},function(t){u(t)},function(t){alert("Error capturing audio.")}):alert("getUserMedia not supported in this browser.");function b(t,E,A){var O=t.length,w=0;if(A==="time")for(;w<E&&w<O;w+=1)t[w]/128-1;else if(A==="frequency"){for(;w<E&&w<O;w+=1)t[w]/128-1;let B=wo(t);Co.shift(),Co.push(B<Vo?0:B);let L=wo(Co);if(lr(L,B),dr(B),T!=null){let Z=mo.variationsOn(T.skyCol,.05*L);T.skyCol=Z;let G=Z;T.sky.material.color.set(mo.parseHex(G));for(let r=0;r<T.clouds.length;r++){for(let n=0;n<T.clouds[r].children.length;n++)if(T.clouds[r].children[n].material.color.set(mo.parseHex(mo.brightenByAmt(G,T.clouds[r].brightness))),Ao&&L>0)T.clouds[r].children[n].rotation.z=T.clouds[r].children[n].rotation.z+L/500;else{let d=T.clouds[r].children[n].rotation.z,M=Math.abs(Math.PI-T.clouds[r].children[n].rotation.z%Math.PI)>d?0:Math.PI;T.clouds[r].children[n].rotation.z=T.clouds[r].children[n].rotation.z%(Math.PI*2)+(M-d)/20}T.clouds[r].position.x=T.clouds[r].position.x-Math.max(.5,L/10),T.clouds[r].position.x<-ro/2-500&&(T.clouds[r].position.x=ro/2+500)}for(let r=0;r<T.looseLeaves.length;r++)T.looseLeaves[r][0].position.x=T.looseLeaves[r][0].position.x-(1+L/20*T.looseLeaves[r][4]),T.looseLeaves[r][0].position.y=T.looseLeaves[r][1]+150*T.looseLeaves[r][3]*Math.sin(.002*T.looseLeaves[r][0].position.x+T.looseLeaves[r][2]),T.looseLeaves[r][0].rotation.z=-Math.PI/4*Math.sin(.002*T.looseLeaves[r][0].position.x+T.looseLeaves[r][2]),T.looseLeaves[r][0].position.x<-ro/2-500&&(T.looseLeaves[r][0].position.x=ro/2+Q.random(ro),T.looseLeaves[r][0].position.y=Q.random(-100,170),T.looseLeaves[r][1]=T.looseLeaves[r][0].position.y);for(let r=0;r<T.stars.length;r++)Math.random()<B/75?T.stars[r].scale.x=T.stars[r].scale.y=T.stars[r].scale.z=Q.random(1.2,2.2):T.stars[r].scale.x=T.stars[r].scale.y=T.stars[r].scale.z=1}}else throw new Error("ERROR - must pass time or frequency")}function S(t){t.inputBuffer.getChannelData(0)}function u(t){o=m.createGain(),o.connect(m.destination),o.gain.value=0,e=m.createMediaStreamSource(t),e.connect(o),s=m.createScriptProcessor(a,1,1),s.onaudioprocess=S,e.connect(s),document.getElementById("player").addEventListener("change",function(){var w=this.value;o.gain.value=w,console.log("curr_volume ",w)}),f=m.createScriptProcessor(2048,1,1),f.connect(o),v=m.createAnalyser(),v.smoothingTimeConstant=0,v.fftSize=2048,e.connect(v),v.connect(f);var E=v.frequencyBinCount,A=new Uint8Array(E),O=new Uint8Array(E);console.log("buffer_length "+E),console.log(uo.info.render),f.onaudioprocess=function(){v.getByteFrequencyData(A),v.getByteTimeDomainData(O),e.playbackState==e.PLAYING_STATE&&(b(A,5,"frequency"),b(O,5,"time"))}}}();
